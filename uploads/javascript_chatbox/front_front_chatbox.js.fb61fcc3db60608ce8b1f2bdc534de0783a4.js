var chatbox=chatbox||{};!function(t,e,n){"use strict";var s,a,i,r,c,o;s=/\bhttps?:\/\/\S+/gi,a=/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;\(\)]*[-A-Z0-9+&@#\/%=~_|])(\.jpg|\.png|\.gif|\.webp)/gi,i=/^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/,r=ips.getSetting("lazyLoadEnabled")?ips.getSetting("blankImg"):null,o=function(t,e,n){if(t.length<=e)return t;var s=e-(n=n||"...").length,a=Math.ceil(s/2),i=Math.floor(s/2);return t.substr(0,a)+n+t.substr(t.length-i)},chatbox={parseContent:function(e,n,c){t.trim(e).match(a)&&(e=e.replace(a,function(t){return"twemoji"==ips.getSetting("emoji_style")&&-1!=t.indexOf("twemoji.maxcdn.com")?"<img class='chatboxEmoji' src='"+t+"'>":n?ips.templates.render("chatbox.parseImage",{url:t,blankImage:r}):t})),c&&t.trim(e).match(i)&&(e=e.replace(i,function(t){var e=/embed\//i.test(t)?t.split(/embed\//)[1].split('"')[0]:t.split(/v\/|v=|youtu\.be\//)[1].split(/[?&]/)[0],n="https://img.youtube.com/vi/"+e+"/mqdefault.jpg";return ips.templates.render("chatbox.parsedVideo",{source:"youtube",id:e,img:n,blankImage:r})}));var l=0;return e=e.replace(s,function(t){var n=e.indexOf(t,l),s=t;return"src='"!==e.substring(n,n-5)&&'srcset="'!==e.substring(n,n-8)&&(t=t.replace(/&amp;/g,"&"),s=ips.templates.render("chatbox.parseURL",{url:t,text:o(t,60)})),l=n+t.length,s}),ips.utils.emoji.getEmoji(function(t,n){for(var s in t)for(var a=0;a<t[s].length;a++)if("custom-"==t[s][a].code.substr(0,7))for(var i=ips.utils.escapeRegexp(t[s][a].name),r=new RegExp("(^|\\s)"+i+"(\\s|$)","gi");e.match(r);)e=e.replace(r,"$1<img class='chatboxEmoticon' src='"+t[s][a].image+"'>$2")}),e},escapeHTML:function(t){var e=document.createElement("div");return e.appendChild(document.createTextNode(t)),e.innerHTML},mention:function(e,n){var s=t(e.currentTarget).data("member");if(t(e.currentTarget).closest(".chatboxContainer").hasClass("chatboxConPopup"))var a=t(e.currentTarget).closest(".chatboxContainer").attr("data-conID"),i=t(".convo_"+a);else a=t(e.currentTarget).closest(".chatboxContainer").attr("data-roomID"),i=t(".room_"+a);if(n){if(i.find("#cke_chatMSG_"+a).is(":visible")){var r=CKEDITOR.instances["chatMSG_"+a],c=t(e.currentTarget).data("url"),o=t(e.currentTarget).data("id");if(parseInt(o)>0){var l=null;(l=new CKEDITOR.dom.element("span")).renameNode("a"),l.setAttribute("href",c),l.setAttribute("contenteditable","false"),l.setAttribute("data-ipsHover",""),l.setAttribute("data-ipsHover-target",c+"?do=hovercard"),l.setAttribute("data-mentionid",o),l.setHtml("@"+s),r.insertElement(l),r.insertHtml(" ")}else r.insertHtml("@"+s+" ")}}else{var u=i.find("#chatMSG").val()+" @"+s+" ";i.find("#chatMSG").val(u).focus()}},toggleControlMSG:function(e){c(e);var n=t(e.currentTarget).closest(".chat_row").find(".msgManageBtn"),s=t(e.currentTarget).closest(".chat_row").find(".cbTime"),a=t(e.currentTarget).closest(".chat_row").find(".msgOptions");n.length>0&&(n.is(":visible")?(n.css("display","none"),s.css("display","inline-block"),a.css("display","inline-block")):(n.css("display","inline-block"),s.css("display","none"),a.css("display","none")))},hideAllControlMSG:c=function(e){t(e.currentTarget).closest("#chatContent").find(".msgManageBtn:visible").each(function(){t(this).css("display","none"),t(this).closest(".chat_row").find(".cbTime").css("display","inline-block"),t(this).closest(".chat_row").find(".msgOptions").css("display","inline-block")})}},String.prototype.startsWith=function(t){return 0===this.lastIndexOf(t,0)}}(jQuery,_);;
!function(t,n,e){"use strict";ips.controller.register("bim.chatbox.startChat",{bim1:!1,initialize:function(){this.on("click",'[data-action="startChat"]',this.startChat)},startChat:function(n){if(this.bim1||0==t(".chatBar").length)return!1;this.bim1=!0;var e=t(n.currentTarget).attr("data-memberID"),o=this;return ips.getAjax()(ips.getSetting("baseURL")+"index.php?app=chatbox&module=conversation&controller=main&do=openConversation",{data:{memberID:e},type:"post"}).done(function(n){if("error"==n.type)ips.ui.alert.show({message:n.message});else if(t(".convoTab_chats_content").find(".convoRow_"+n.conID).length>0)t(".convoTab_chats_content").find(".convoRow_"+n.conID).click();else{var e=ips.templates.render("chatbox.newcon.temp",{id:n.conID});t("#convoIframe").append(e),t(document).trigger("contentChange",[t("#convoIframe")]),t("#convoIframe").find(".convoRow_"+n.conID).click()}}).always(function(t){o.bim1=!1}),!1}})}(jQuery,_);;
!function(i,t,e){"use strict";ips.controller.register("bim.chatbox.editor",{bim1:null,bim2:null,bim3:null,bim4:null,bim5:!1,bim6:0,bim7:!1,bim8:!1,bim9:!1,initialize:function(){this.setup(),this.on("fileAdded",this.resizeBar),this.on("fileDeleted",this.resizeBar),this.bim1=setInterval(t.bind(this.updateEditor,this),500)},setup:function(){this.scope.hasClass("chatboxConPopup")?(this.bim2=this.scope.attr("data-conID"),this.bim3=i(".convo_"+this.bim2),this.bim4="chatCON_"+this.bim2):(this.bim2=this.scope.attr("data-roomID"),this.bim3=i(".room_"+this.bim2),this.bim4="chatMSG_"+this.bim2),this.bim5=1==this.scope.attr("data-useEnter")},updateEditor:function(){var i=this,t=CKEDITOR.instances[this.bim4];t&&(t.on("instanceReady",function(){t.setData(""),ips.utils.db.remove("editorSave",t.config.ipsAutoSaveKey),i.bim7||(i.bim7=!0)}),t.on("change",function(){i.bim6!=i.bim3.find("#elChatboxEditor").height()&&(i.resizeBar(),i.bim6=i.bim3.find("#elChatboxEditor").height()),i.bim8||(i.bim8=!0)}),i.bim5&&t.on("key",function(t){13==t.data.keyCode&&(t.cancel(),i.bim3.find("#elChatboxEditor").find("form").submit()),i.bim9||(i.bim9=!0)}),i.bim7&&i.bim8&&i.bim9&&clearInterval(i.bim1))},resizeBar:function(){i(".chatBar").trigger("resizeBar")}})}(jQuery,_);;
!function(t,e,i){"use strict";ips.controller.register("bim.chatbox.main",{bim1:null,bim2:null,bim3:null,bim4:"",bim5:null,bim6:null,bim7:null,bim8:null,bim9:null,bim10:null,bim11:!0,bim12:!1,bim13:!1,bim14:!1,bim15:!1,bim16:!1,bim17:!1,bim18:0,bim19:0,bim20:0,bim21:0,bim22:0,bim23:{},initialize:function(){this.scope.find(".convoList").length>0&&(this.setup(),this.on("focus","#searchMem",this.focusSearchMem),this.on("blur","#searchMem",this.blurSearchMem),this.on("click",'[data-action="closeSearch"]',this.closeSearch),this.on("click",'[data-action="openConversation"]',this.openConversation),this.on("click",'[data-action="openRoom"]',this.openRoom),this.on("menuItemSelected",".conOptions",this.conOptions),this.on("click",'.convoList [data-action="toggleChat"], .convoTab [data-action="toggleChat"]',this.toggleChat),this.on("click",'[data-action="closeChat"]',this.closeChat),this.on("click",'[data-action="msgOptions"]',function(t){return chatbox.toggleControlMSG(t),!1}),this.on("click",".convoTab .chat_row",function(t){chatbox.hideAllControlMSG(t)}),this.on("click",'.convoTab [data-action="mention"]',this.mention),this.scope.find(".convoTab #chatContentIframe").on("scroll",e.bind(this.autoLoad,this)),this.on("click",'[data-action="deleteMSG"]',this.deleteMSG),this.on("click",'[data-action="reportMSG"]',this.reportMSG),this.on("click",'[data-action="convoTabChange"]',this.convoTabChange),this.on("focus",".convoTab #chatMSG",this.readTab),this.bim5.use_editor?(this.on("submit",'.convoTab [data-role="chatboxFormArea"] form',this.submitEditor),this.on("click",'.convoTab [data-action="editMSG"]',this.editEditor)):(this.on("click",'.convoTab [data-action="sendMSG"]',this.sendMSG),this.on("submit",'.convoTab [data-action="chatForm"]',this.sendMSG),this.on("keypress",".convoTab #chatInputArea textarea",this.submitCleanText),this.on("click",'.convoTab [data-action="editMSG"]',this.editMSG),this.on("keypress",'.convoTab [data-action="doEdit"]',this.doEdit))),this.resizeBar(),this.on(window,"resize",this.resizeBar),this.scope.bind("resizeBar",this.resizeBar),t(".mbBottomPlayer").length&&t(".mbBottomPlayer").is(":visible")&&this.scope.closest(".chatBar").css({bottom:"57px"}),moment.locale(ips.getSetting("chatbox_momentLocale")),this.scope.css("visibility","visible");var i=ips.getSetting("chatbox_tabCount");if(i>-1){var o=t('[data-role="navBarItem"][data-navApp="chatbox"][data-navExt="Chatbox"] > a');o.length>0&&(o.append(t("<span/>").addClass("ipsNotificationCount chatboxTabCount cbTabCount_"+i).text(i)),setInterval(function(){ips.getAjax()(ips.getSetting("baseURL")+"index.php?app=chatbox&module=conversation&controller=main&do=tabCount").done(function(e){1!=self._joined&&(e.count>0?t(".chatboxTabCount").text(e.count).removeClass("cbTabCount_0"):t(".chatboxTabCount").text("0").addClass("cbTabCount_0"))})},15e3))}},setup:function(){var t=this;t.bim1=ips.getSetting("baseURL")+"index.php?app=chatbox&module=conversation&controller=main",t.bim2="chatbox_mem_popups_"+ips.getSetting("chatbox_member_id"),t.bim5=ips.getSetting("chatbox_conversations"),t._blankImage=ips.getSetting("lazyLoadEnabled")?ips.getSetting("blankImg"):null,t.bim7=t.bim5.soundfile?t.bim5.soundfile:ips.getSetting("baseURL")+"applications/core/interface/sounds/notification.mp3",ips.loader.get(["core/interface/howler/howler.core.min.js"]).then(function(){t._sound=new Howl({src:t.bim7,autoplay:!1})}),t.bim8=t.scope.find("#convoContent .convoResults"),t.bim9=t.scope.find("#convoContent .searchResults"),t.updateChat()},syncTabs:function(){var e=this,i=[];e.scope.find(".convoTab").each(function(o){if(!t(this).hasClass("minimize")){var n="convo_"+t(this).find(".chatboxContainer").attr("data-conID");if(void 0===e.bim23[n]&&(e.bim23[n]={lastID:0,firstLoad:1,canLoadOld:1,useAutoLoad:0}),"asc"==e.bim5.sort)var a=e.bim23[n].lastID>0?e.bim23[n].lastID:t("."+n).find(".chat_row").last().attr("id");else a=e.bim23[n].lastID>0?e.bim23[n].lastID:t("."+n).find(".chat_row").first().attr("id");e.bim23[n].lastID=a>0?a:0,i.push(n)}}),t.each(e.bim23,function(o,n){-1===t.inArray(o,i)&&delete e.bim23[o]})},readTab:function(e){var i=t(e.currentTarget).closest(".chatboxContainer").attr("data-conID");this.updateFocusTabs(i)},updateFocusTabs:function(e){var i=t(".convo_"+e),o=parseInt(i.find(".mainTitle").find(".newMsgCount").text());o=isNaN(o)?0:o;var n=0!=this.bim19?this.bim19.split(","):[];if(n.indexOf(e)<0&&n.unshift(e),n.length>0&&(this.bim19=n.join(",")),o>0&&i.find(".mainTitle").find(".newMsgCount").is(":visible")){i.find(".mainTitle").find(".newMsgCount").hide().text(),i.find(".miniTitle").find(".newMsgCount").hide().text(),t('.convoTab_chats_content .ipsAutocompleteMenu_item[data-conid="'+e+'"]').find(".newMsgCountTxt").hide().text(),t('.convoTab_chats_content .ipsAutocompleteMenu_item[data-conid="'+e+'"]').removeClass("mentionMe");var a=parseInt(t(".convoList .popupTitle").find(".newMsgCount").text());(a=isNaN(a)?0:a-o)>0?t(".convoList").find(".newMsgCount").show().text(a):t(".convoList").find(".newMsgCount").hide().text(),this.bim15&&(a>0?i.find(".totalMsgCount").show().text(a):i.find(".totalMsgCount").hide().text())}},updateChat:function(t){var e=this;if(e.bim16&&!e.bim11)return!1;1==t&&clearTimeout(e.bim6);var i=e.bim5.interval>3e3?e.bim5.interval:3e3;e.doUpdateChat(function(){e.bim6=setTimeout(function(){e.updateChat(!0)},i)})},doUpdateChat:function(e){var i=this;if(i.bim12)return!1;i.bim12=!0;var o=!0;i.syncTabs(),ips.getAjax()(i.bim1+"&do=updateChat",{type:"post",dataType:"json",data:{tabData:JSON.stringify(i.bim23),roomsLastUpdate:i.bim21,conLastMsgID:i.bim18,activeTab:i.bim22,focusTabs:i.bim19}}).done(function(n){"error"==n.type?ips.ui.alert.show({message:n.message}):(n.ping&&(n.ping.rooms&&(t(".convoTab_rooms_content").html(i.myConvoRoomsHTML(n.ping.rooms)),t(document).trigger("contentChange",[t(".convoTab_rooms_content")]),i.bim21=n.ping.rooms[0].lastUpdate),n.ping.chats&&(i.bim5.no_counter_popup&&t.each(n.ping.chats,function(e,a){t(".convo_"+a.id).length>0&&!t(".convo_"+a.id).hasClass("minimize")&&parseInt(a.unread)>0&&(n.ping.chats[e].unread="0",i.updateFocusTabs(a.id),o=!1)}),t(".convoTab_chats_content").html(i.myConvoChatsHTML(n.ping.chats)),t(document).trigger("contentChange",[t(".convoTab_chats_content")]),i.bim18=n.ping.chats[0].lastMsgID),t(".chatBar").find(".ipsOnlineStatus_online:not(.cbMemOnline)").hide(),n.ping.online&&t.each(n.ping.online,function(e,i){t(".convo_"+i).length>0&&t(".convo_"+i).find(".ipsOnlineStatus_online").show(),t(".convoRow_"+i).find(".ipsOnlineStatus_online").show()}),i.notify(n.ping.chats)),n.tabs&&t.each(n.tabs,function(e,o){if(void 0!==i.bim23["convo_"+e]&&i.bim23["convo_"+e].lastID!=o.lastID&&o.messages){var n=t(".convo_"+e).find("#chatContentIframe"),a=t(".convo_"+e).find("#chatContent");if("asc"==i.bim5.sort){if(n.scrollTop()+n.innerHeight()-n.prop("scrollHeight")>=-30)var s=1;a.append(i.chatRowHTML(o.messages)),t(document).trigger("contentChange",[n]),(1==s||i._forceScrollDown)&&i.goDown(e)}else a.prepend(i.chatRowHTML(o.messages)),t(document).trigger("contentChange",[n]);1==ips.utils.cookie.get("chatbox_con_nosound_"+e)||1==i.bim23["convo_"+e].firstLoad||i.bim17||i._sound.play(),a.find("img").imagesLoaded(function(t){i.bim23["convo_"+e].firstLoad=0}),i.bim23["convo_"+e].lastID=o.lastID}}),i.bim22>0&&t(".convo_"+i.bim22).find(".ipsLoading").removeClass("ipsLoading"),n.changes&&t.each(n.changes,function(e,o){o?t("#"+e+" .chatbox_msg").html(i.parseContent(o)):t("#"+e).remove()})),"function"==typeof e&&e()}).fail(function(){}).always(function(t){i.bim11=!1,i._forceScrollDown=!1,i.bim12=!1,i.bim22=0,o&&(i.bim19=0)})},notify:function(e){if(e){var i=this,o=0,n=0!=i.bim19?i.bim19.split(","):[];if(i.bim11){var a={};t.each(e,function(t,e){parseInt(e.unread)>0&&(a[e.id+""]=e.unread)}),i.bim20=a}if(t.each(e,function(e,a){if(!(n.indexOf(a.id)>=0))if(parseInt(a.unread)>0){if(o+=parseInt(a.unread),t(".convo_"+a.id).find(".newMsgCount").show().text(a.unread),t('.convoTab_chats_content [data-conid="'+a.id+'"]').find(".newMsgCountTxt").show().text("("+a.unread+")"),!i.bim11){if(1==ips.utils.cookie.get("chatbox_con_nosound_"+a.id)||i.bim17||i._sound.play(),i.bim20&&void 0!==i.bim20[a.id]){if(a.unread<=i.bim20[a.id])return;i.bim20[a.id]=a.unread}if(i.bim15){var s=ips.templates.render("chatbox.newcon.notify",{id:a.id,title:a.title,icon:a.icon,lastMsg:a.lastMsg,time:a.lastMsgTime});t("#elFlashMessage").is(":visible")&&t("#elFlashMessage").find('[data-role="newNotification"]').length?t("#elFlashMessage").find('[data-role="newNotification"]').replaceWith(s):ips.ui.flashMsg.show(s,{timeout:5,position:"top",sticky:!1,extraClasses:"chatboxflashMsg ipsPad_half",escape:!1})}else t(".chatBar").find(".convo_"+a.id).length<=0&&t('.convoTab_chats_content [data-conid="'+a.id+'"]').click()}}else t(".convo_"+a.id).find(".newMsgCount").hide().text(),t('.convoTab_chats_content [data-conid="'+a.id+'"]').find(".newMsgCountTxt").hide().text()}),o>0?t(".convoList").find(".newMsgCount").show().text(o):t(".convoList").find(".newMsgCount").hide().text(),i.bim15){var s=parseInt(t(".convoList .mainTitle").find(".newMsgCount").text());s>0?t(".convoTab").find(".totalMsgCount").show().text(s):t(".convoTab").find(".totalMsgCount").hide().text()}}},openConversation:function(i){var o=this,n=t(i.currentTarget).attr("data-conID"),a=t(i.currentTarget).attr("data-memberID");if(n>0)var s=t(".chatBar").find(".convo_"+n);else{var c=t(i.currentTarget).find("strong").text();s=t(".chatBar").find('.mainTitle .conNames[title="'+c+'"]').closest(".bimChatbox")}if(s.length>0)return s.hasClass("minimize")?s.find('.popupTitle[data-action="toggleChat"]').click():s.fadeOut(80).fadeIn(80).find("#chatMSG").focus(),!1;t(".chatBar").prepend(ips.templates.render("chatbox.blankCon",{conID:n}));var r=t(".chatBar").find(".convo_"+n);return ips.getAjax()(o.bim1+"&do=openConversation",{data:{memberID:a,conID:n},type:"post"}).done(function(n){if("error"==n.type)ips.ui.alert.show({message:n.message}),r.remove();else{r.replaceWith(n.html);var a=t(".chatBar").find(".convo_"+n.conID);a.removeClass("minimize"),t(document).trigger("contentChange",[a]);var s=o.getMyPopups();if(s.indexOf("c_"+n.conID)<0&&(s.unshift("c_"+n.conID),o.saveMyPopups(s.join("|"))),t(i.currentTarget).find(".newMsgCountTxt").text()){var c=parseInt(t(i.currentTarget).find(".newMsgCountTxt").text().replace(/^\D+/g,""));a.find(".newMsgCount").text(c),o.updateFocusTabs(n.conID)}o.bim22=n.conID,o.updateChat(!0),o.closeOldPopups(),t(i.currentTarget).removeClass("mentionMe"),o.scope.find(".convo_"+n.conID+" #chatContentIframe").on("scroll",e.bind(o.autoLoad,o)),o.resizeBar()}}).always(function(t){}),!1},autoLoad:function(e){if(!this.bim5.autoload)return!1;var i=this,o=t(e.currentTarget),n=o.find("#chatContent"),a=o.closest(".chatboxContainer").attr("data-conID");if(0==t(".convo_"+a).length)return!1;if(void 0===i.bim23["convo_"+a])return!1;if(1==i.bim23["convo_"+a].firstLoad||1!=i.bim23["convo_"+a].canLoadOld)return!1;if("asc"==this.bim5.sort){if(0!=o.scrollTop())return!1;var s=n.children().first().attr("id")}else{if(o.scrollTop()+o.innerHeight()<o[0].scrollHeight)return!1;s=n.children().last().attr("id")}if(o.find("#loadMore").length<=0){var c=ips.templates.render("chatbox.loadMore");"asc"==this.bim5.sort?n.prepend(c):n.append(c)}i.bim23["convo_"+a].canLoadOld=0,i.bim23["convo_"+a].useAutoLoad=1,ips.getAjax()(i.bim1+"&do=checkTabs",{type:"post",dataType:"json",data:{tabData:JSON.stringify(i.bim23),activeTab:a,loadMoreMode:s}}).done(function(e){if("error"==e.type)ips.ui.alert.show({message:e.message});else if(e.tabs[a]){var c=e.tabs[a].messages;c?("asc"==i.bim5.sort?(n.prepend(i.chatRowHTML(c)),o.scrollTop(n.find("#"+s).position().top-50)):n.append(i.chatRowHTML(c)),t(document).trigger("contentChange",[o]),i.bim23["convo_"+a].canLoadOld=1):i.bim23["convo_"+a].canLoadOld=0}o.find("#loadMore").remove()}).fail(function(){})},sendMSG:function(e){e.preventDefault();var i=this;if(i.bim13)return!1;var o=t(e.currentTarget).closest(".chatboxConPopup").attr("data-conID"),n=t(".convo_"+o).find("#chatMSG"),a=chatbox.escapeHTML(n.val());return 0!=i.checkMSG(a)&&0!=i.checkFlood()&&(i.toggleInputForm(o,0),ips.getAjax()(i.bim1+"&do=sendMSG",{type:"post",dataType:"json",data:{msg:a,conID:o}}).done(function(e){"error"==e.type?ips.ui.alert.show({message:e.message}):"deletedCon"==e.type?(ips.ui.alert.show({message:e.message}),i.closeConversation(e.conID)):(i.bim17=!0,i.bim22=o,i.updateChat(!0),i.bim5.lastchat=t.now())}).always(function(t){i.toggleInputForm(o,1),i.bim13=!1,i._forceScrollDown=!0,i.bim23["convo_"+o].useAutoLoad=0}),!1)},submitCleanText:function(e){if(13===e.which)return t(e.currentTarget).closest("form").submit(),!1},deleteMSG:function(e){var i=this,o=t(e.currentTarget).closest(".chat_row").attr("id");return ips.ui.alert.show({type:"confirm",message:ips.getString("chatbox_confirmDelete"),icon:"warn",buttons:{ok:ips.getString("chatbox_confirm_yes"),cancel:ips.getString("chatbox_confirm_cancel")},callbacks:{ok:function(){ips.getAjax()(i.bim1+"&do=deleteMSG",{type:"post",data:{chatID:o}}).done(function(i){"error"==i.type?ips.ui.alert.show({message:i.message}):(ips.ui.flashMsg.show(ips.getString("chatbox_deleted")),t(e.currentTarget).closest(".chat_row").remove())})}}}),!1},reportMSG:function(e){var i=t(e.currentTarget).closest(".chat_row").attr("id"),o=t(e.currentTarget).closest(".chatboxContainer").attr("data-conID"),n=ips.ui.dialog.create({url:ips.getSetting("baseURL")+"index.php?app=chatbox&module=conversation&controller=conversation&do=reportComment&id="+o+"&comment="+i,size:"normal",title:ips.getString("chatbox_report"),forceReload:!1,destructOnClose:!0,callback:function(e){t(e).find("form").on("submit",function(e){for(var i in e.preventDefault(),CKEDITOR.instances)CKEDITOR.instances[i].updateElement();var o=t(e.currentTarget);return ips.getAjax()(o.attr("action"),{data:o.serialize(),type:"post",bypassRedirect:!0}).done(function(t){ips.ui.flashMsg.show(ips.getString("chatbox_sent_report"))}).always(function(t){n.hide()}),!1})}});return n.show(),!1},editMSG:function(e){var i=this,o=t(e.currentTarget).closest(".chat_row").attr("id"),n=t(e.currentTarget).closest(".chatboxContainer").attr("data-conID"),a=t(".convo_"+n).find("#chatRow_"+o),s=t(".convo_"+n).find("#chatRow_"+o+" .chatbox_msg");return i.bim14?(a.find(".editChatInput").length>0&&(a.find(".editChatInput").remove(),s.show(),t(e.currentTarget).html('<i class="fa fa-pencil"></i>').attr("_title",ips.getString("chatbox_btn_edit")),i.bim14=!1,i.toggleInputForm(n,1)),!1):(ips.getAjax()(i.bim1+"&do=editMSG",{type:"post",data:{chatID:o}}).done(function(o){"error"==o.type?ips.ui.alert.show({message:o.message}):(t(e.currentTarget).html(ips.getString("chatbox_btn_cancel")).attr("_title",ips.getString("chatbox_btn_cancel")),s.after(ips.templates.render("chatbox.editInput")),s.hide(),a.find(".editChatInput").val(o.content).focus(),i.bim14=!0,i.toggleInputForm(n,0))}),!1)},doEdit:function(e){if(13==e.which){var i=this,o=t(e.currentTarget).closest(".chat_row").attr("id"),n=t(e.currentTarget).closest(".chatboxContainer").attr("data-conID"),a=i.scope.find("#chatRow_"+o),s=i.scope.find("#chatRow_"+o+" .chatbox_msg"),c=chatbox.escapeHTML(t(e.currentTarget).val());return 0!=i.checkMSG(c)&&(ips.getAjax()(i.bim1+"&do=doEdit",{type:"post",data:{chatID:o,msg:c}}).done(function(e){"error"==e.type?ips.ui.alert.show({message:e.message}):(ips.ui.flashMsg.show(ips.getString("chatbox_edited")),s.show().html(i.parseContent(e.content)),a.find(".editChatInput").remove(),i.scope.find("#"+o).find(".editBtn").html('<i class="fa fa-pencil"></i>').attr("_title",ips.getString("chatbox_btn_edit")),t(document).trigger("contentChange",[i.scope.find(".chatboxContainer")]),i.bim14=!1,i.updateChat(!0))}).always(function(t){i.toggleInputForm(n,1)}),!1)}},toggleInputForm:function(e,i){var o=t(".convo_"+e),n=o.find("#chatMSG"),a=o.find('[data-action="sendMSG"]');1==i?(this.bim13=!1,a.prop("disabled",!1),n.val(""),n.closest("form").hasClass("expanded")&&(n.closest("form").removeClass("expanded"),n.css("height","auto"),t(".chatBar").trigger("resizeBar"))):(this.bim13=!0,a.prop("disabled",!0))},getMyPopups:function(){return ips.utils.cookie.get(this.bim2)?ips.utils.cookie.get(this.bim2).split("|"):[]},saveMyPopups:function(t){ips.utils.cookie.set(this.bim2,t)},myConvoRoomsHTML:function(e){var i="chatbox"==t("body").data("pageapp")&&"room"==t("body").data("pagecontroller"),o="";return t.each(e,function(e,n){i&&n.id==t("body").data("pageid")?t(".room_"+n.id).find('[data-action="closeChat"]').click():o+=ips.templates.render("chatbox.convo.list.rooms",{id:n.id,title:n.title,icon:n.icon,users:n.users})}),o},myConvoChatsHTML:function(e){var i="";return t.each(e,function(e,o){if(o.lastMsg&&(i+=ips.templates.render("chatbox.newcon.chats",{id:o.id,title:o.title,icon:o.icon,isOnline:o.isOnline,lastMsg:o.lastMsg,time:o.lastMsgTime,unread:o.unread>0?o.unread:null})),t(".convo_"+o.id).length>0){var n=t(".convo_"+o.id).find(".ipsOnlineStatus_online");!o.isOnline&&n.is(":visible")?n.hide():o.isOnline&&n.is(":hidden")&&n.show()}}),i},convoTabChange:function(e){var i=t(e.currentTarget).attr("id");return t(e.currentTarget).closest(".convoTabs").find("a").removeClass("isActive"),t(e.currentTarget).addClass("isActive"),t(".cvtabContent").hide(),t("."+i+"_content").show(),!1},closeOldPopups:function(){if(!this.bim15){t(window).width()<330*t(".chatBar .inGlobalChat").length-1&&t(".chatBar .inGlobalChat:last").prev().find('[data-action="closeChat"]').click()}},focusSearchMem:function(){this.bim3=setInterval(e.bind(this.checkSearching,this),700)},blurSearchMem:function(){clearInterval(this.bim3)},closeSearch:function(){return this.bim4=null,t(".closeSearchBtn").hide(),this.bim9.hide(),this.bim8.show(),this.scope.find("#searchMem").val(""),!1},checkSearching:function(){var e=this.scope.find("#searchMem").val();if(!(e.length<3||e==this.bim4)){this.bim4=e,t(".closeSearchBtn").show(),this.bim10&&this.bim10.abort&&this.bim10.abort();var i=this;return this.bim10=ips.getAjax()(i.bim1+"&do=findMember",{data:{input:i.bim4},type:"post"}).done(function(e){if(e.length){var o="";t.each(e,function(t,e){console.log(e.isBan),o+=ips.templates.render("chatbox.newcon.mem",{value:i.bim4,id:e.id,photo:e.photo,isOnline:e.isOnline,name:e.name,extra:e.extra,conID:e.conID,isBan:e.isBan})}),i.bim9.html(o).show(),i.bim8.hide()}}),!1}e||this.closeSearch()},openRoom:function(e){var i=this,o=t(e.currentTarget).attr("data-roomID"),n=t(".chatBar").find(".room_"+o);if(!(n.length>0)){t(".chatBar").prepend(ips.templates.render("chatbox.blankRoom",{roomID:o}));var a=t(".chatBar").find(".room_"+o);return ips.getAjax()(i.bim1+"&do=openRoom",{type:"post",data:{room:o}}).done(function(e){if("error"==e.type)ips.ui.alert.show({message:e.message}),a.remove();else{a.replaceWith(e.html),ips.setSetting("chatbox_"+o,e.config);var n=t(".chatBar").find(".room_"+o);n.removeClass("minimize"),t(document).trigger("contentChange",[n]),n.find("#chatMSG")&&n.find("#chatMSG").focus();var s=i.getMyPopups();s.indexOf("r_"+o)<0&&(s.unshift("r_"+o),i.saveMyPopups(s.join("|"))),i.closeOldPopups(),i.resizeBar()}}),!1}n.hasClass("minimize")?n.find('.popupTitle[data-action="toggleChat"]').click():n.fadeOut(80).fadeIn(80).find("#chatMSG").focus()},chatRowHTML:function(e){var i=this,o="",n="",a="",s="chatbox.style."+this.bim5.style;return t.each(e,function(t,e){a=ips.getSetting("baseURL")+"index.php?app=core&module=members&controller=profile&id="+e.chatterID,n=a+"&do=hovercard",o+=ips.templates.render(s,{id:e.id,chatterID:e.chatterID,chatterName:e.chatterName,chatterKey:e.chatterKey,chatterNameFormat:e.chatterNameFormat,chatterPhoto:e.chatterPhoto,chatterUrl:a,memberHovercard:n,content:i.parseContent(e.content),callme:-1!=e.content.indexOf("@"+ips.getSetting("chatbox_member_name")),isMe:e.chatterName==ips.getSetting("chatbox_member_name"),showAgoTime:e.showAgoTime,showDate:e.showDate,canEdit:e.canEdit,canDelete:e.canDelete,canReport:e.canReport,canManageMSG:e.canEdit||e.canDelete})}),o},parseContent:function(t){return this.bim5.use_editor?t:chatbox.parseContent(t,this.bim5.allow_img,this.bim5.allow_video)},submitEditor:function(e){e.preventDefault();var i=this;if(i.bim13)return!1;var o=t(e.currentTarget).closest(".chatboxConPopup").attr("data-conID"),n=t(".convo_"+o),a=t(e.currentTarget),s=CKEDITOR.instances["chatCON_"+o].getData();if(0==i.checkMSG(s)||0==i.checkFlood())return!1;a.find('button[type="submit"]').prop("disabled",!0).text(ips.getString("chatbox_posting")),i.bim13=!0,ips.getAjax()(a.attr("action"),{data:a.serialize(),type:"post",bypassRedirect:!0}).done(function(e){"error"==e.type?(ips.ui.alert.show({message:e.message}),i.bim13=!1):"deletedCon"==e.type?(ips.ui.alert.show({message:e.message}),i.closeConversation(e.conID)):(ips.ui.editor.getObj(n.find('[data-role="chatboxFormArea"] [data-ipsEditor]')).reset(),i.bim17=!0,i.bim22=o,i.updateChat(!0),i.bim5.lastchat=t.now(),t(".chatBar").trigger("resizeBar"))}).always(function(){a.find('button[type="submit"]').prop("disabled",!1).text(ips.getString("chatbox_send")),i.bim13=!1,i._forceScrollDown=!0,i.bim23["convo_"+o].useAutoLoad=0})},editEditor:function(e){var i=this,o=t(e.currentTarget).closest(".chat_row").attr("id"),n=t(e.currentTarget).closest(".chatboxContainer"),a=n.attr("data-conID"),s=ips.ui.dialog.create({url:i.bim1+"&do=editEditor&chatID="+o,size:"normal",title:ips.getString("chatbox_edit"),forceReload:!0,destructOnClose:!0,callback:function(){t(".ipsDialog_content #elChatboxEditor").find("form").on("submit",function(e){if(e.preventDefault(),i.bim14)return!1;i.bim14=!0;var c=CKEDITOR.instances["chatCON_"+a+"_"+o];c.updateElement();var r=c.getData();if(0==i.checkMSG(r))return!1;var h=t(e.currentTarget);return ips.getAjax()(h.attr("action"),{data:h.serialize(),type:"post",bypassRedirect:!0}).done(function(e){"error"==e.type?ips.ui.alert.show({message:e.message}):(ips.ui.flashMsg.show(ips.getString("chatbox_edited")),n.find("#chatRow_"+o+" .chatbox_msg").html(i.parseContent(e.content)),t(document).trigger("contentChange",[n]),i.updateChat(!0))}).always(function(t){s.hide(),i.bim14=!1}),!1})}});return s.show(),!1},checkFlood:function(){if(this.bim5.flood>0&&1!=this.bim5.canManage&&!this.bim5.canBypassFlood){var e=(t.now()-this.bim5.lastchat)/1e3;if(e<this.bim5.flood)return ips.ui.alert.show({message:ips.getString("chatbox_error_flood",{time:(this.bim5.flood-e).toFixed(2)})}),0}return 1},checkMSG:function(t){t=t.trim();var e=this.bim5.length;return t.length<=0?(ips.ui.alert.show({message:ips.getString("chatbox_error_empty")}),0):e>0&&t.length>e?(ips.ui.alert.show({message:ips.pluralize(ips.getString("chatbox_error_maxlength"),e)}),0):1},conOptions:function(e,i){(e=i?i.originalEvent:e).preventDefault();switch(t(e.target).attr("data-action")){case"toggleSound":this.toggleSound(e,i);break;case"closeAllTabs":this.closeAllTabs(e,i);break;case"miniAllTabs":this.miniAllTabs(e,i);break;case"delCon":this.delCon(e,i);break;case"changeSkin":this.changeSkin(e,i)}},toggleSound:function(e,i){i.originalEvent.preventDefault();var o=t(e.target).closest(".chatboxContainer").attr("data-conID"),n=ips.utils.cookie.get("chatbox_con_nosound_"+o);this.scope.find('[data-action="toggleSound"] .fa').replaceWith(t("<i/>").addClass("fa").addClass(1!=n?"fa-volume-off":"fa-volume-up").removeClass(1!=n?"fa-volume-up":"fa-volume-off")),1==n?ips.utils.cookie.set("chatbox_con_nosound_"+o,0):ips.utils.cookie.set("chatbox_con_nosound_"+o,1),ips.ui.flashMsg.show(ips.utils.cookie.get("chatbox_con_nosound_"+o)?ips.getString("chatbox_soundDisabled"):ips.getString("chatbox_soundEnabled"))},closeAllTabs:function(e,i){return i.originalEvent.preventDefault(),t(".chatBar").find(".inGlobalChat").each(function(e){t(this).find('.miniTitle [data-action="closeChat"]').click()}),!1},miniAllTabs:function(e,i){return i.originalEvent.preventDefault(),t(".chatBar").find(".inGlobalChat").each(function(e){t(this).hasClass("minimize")||t(this).find('.mainTitle [data-action="toggleChat"]').click()}),!1},delCon:function(e,i){i.originalEvent.preventDefault();var o=this,n=t(e.target).closest(".chatboxContainer").attr("data-conID");return ips.ui.alert.show({type:"confirm",message:ips.getString("chatbox_del_con_cfr"),icon:"warn",buttons:{ok:ips.getString("chatbox_confirm_yes"),cancel:ips.getString("chatbox_confirm_cancel")},callbacks:{ok:function(){ips.getAjax()(o.bim1+"&do=delCon",{type:"post",data:{conID:n}}).done(function(t){"error"==t.type?ips.ui.alert.show({message:t.message}):(o.closeConversation(n),o.resizeBar())})}}}),!1},changeSkin:function(e,i){i.originalEvent.preventDefault();var o=t(e.target).data("skin"),n=t(e.target).closest(".chatboxContainer").attr("data-conID");return t(e.target).closest(".chatboxSkins").find("li").removeClass("skinSelected"),t(e.target).addClass("skinSelected"),t(e.target).closest(".bimChatbox").removeClass(function(t,e){return(e.match(/(^|\s)skin_\S+/g)||[]).join(" ")}),t(e.target).closest(".bimChatbox").addClass("skin_"+o),n>0?ips.utils.cookie.set("chatbox_con_skin_"+n,o):ips.utils.cookie.set("chatbox_maincon_skin",o),!1},mention:function(t){return t.preventDefault(),chatbox.mention(t,this.bim5.use_editor),!1},resizeBar:function(){if(t(".chatBar").find(".convoList").length>0)if(ips.utils.responsive.currentIs("tablet")||ips.utils.responsive.currentIs("phone")){t(".chatBar").addClass("chatBoxMessenger"),this.bim15=!0;var e=t(".chatBar").find(".openFromBar").length;0==e?t(".chatBar").find(".convoList").show():1==e?t(".chatBar").find(".convoList").hide():e>1&&t(".chatBar").find(".openFromBar").each(function(e){t(this).find('[data-action="closeChat"]').click()})}else t(".chatBar").find(".convoList").show(),t(".chatBar").removeClass("chatBoxMessenger"),this.bim15=!1;var i=1==ips.getSetting("chatbox_bar_full")&&ips.utils.responsive.currentIs("phone")?t(window).height():ips.getSetting("chatbox_popup_height");return t(".mbBottomPlayer").length&&t(".mbBottomPlayer").is(":visible")&&(i-=57),t(".chatBar .inGlobalChat").each(function(){if(!t(this).hasClass("minimize")){var e=i<=t(window).height()?i:t(window).height(),o=t(this).find(".ipsScrollbar");if(1!=ips.getSetting("chatbox_force_scroll_down"))var n=o.scrollTop()+o.innerHeight()-o.prop("scrollHeight")>=-30;else n=!0;e<=t(this).height()?o.height(o.height()-(t(this).height()-e)):o.height(i-(t(this).height()-o.height())),t(this).height()>t(window).height()&&o.height(o.height()-(t(this).height()-t(window).height())),n&&o.hasClass("asc")&&o.scrollTop(o.prop("scrollHeight"))}}),t(".cbLastMSG").width(t(".convoList").width()-63),!1},toggleChat:function(e){e.preventDefault();var i=t(e.currentTarget).closest(".bimChatbox");if(i.hasClass("minimize")){if(i.removeClass("minimize"),i.hasClass("convoTab")){var o=i.find(".chatboxContainer").attr("data-conID");this.updateFocusTabs(o),this.bim22=o,this.updateChat(!0)}this.resizeBar(),this.bim15&&t(".chatBar").css({width:"100%"})}else i.addClass("minimize"),this.bim15&&t(".chatBar").css({width:"auto"});return!1},closeChat:function(e){var i=this.getMyPopups(),o=t(e.currentTarget).closest(".chatboxContainer");o.closest(".bimChatbox").hasClass("minimize");if(o.hasClass("chatboxConPopup")){var n="c_"+(a=o.attr("data-conID"));delete this.bim23["convo_"+a]}else{var a;n="r_"+(a=o.attr("data-roomID"))}return i.splice(t.inArray(n,i),1),this.saveMyPopups(i.join("|")),t(e.currentTarget).closest(".bimChatbox").remove(),this.bim15&&t(".convoList").hasClass("minimize")?t(".convoList").find('.miniTitle[data-action="toggleChat"]').click():this.resizeBar(),!1},closeConversation:function(e){t(".convo_"+e).find('[data-action="closeChat"]').click(),t(".convoTab_chats_content").find('[data-conid="'+e+'"]').remove()},goDown:function(e){var i=this,o=t(".convo_"+e).find("#chatContentIframe"),n=t(".convo_"+e).find("#chatContent");1!=i.bim23["convo_"+e].useAutoLoad&&o.scrollTop(o.prop("scrollHeight")),i._blankImage?ips.utils.lazyLoad.observe(n,{imgLoadedCallback:function(){1!=i.bim23["convo_"+e].useAutoLoad&&o.scrollTop(o.prop("scrollHeight"))}}):o.find("img").imagesLoaded(function(t){1!=i.bim23["convo_"+e].useAutoLoad&&o.scrollTop(o.prop("scrollHeight"))})}})}(jQuery,_);;
!function(t,i,e){"use strict";ips.controller.register("bim.chatbox.media",{bim1:null,bim2:null,bim3:null,bim4:"",initialize:function(){this.scope.find("#chatMSG").length>0&&(this.on("click",'[data-action="emoji"]',this.emoji),this.on("click",'[data-action="bimGiphy"]',this.bimGiphy),this.on("focus","#chatMSG",this.focusChatInput),this.on("blur","#chatMSG",this.blurChatInput)),this.on("click",'[data-action="playVideoInPopup"]',this.playVideoInPopup),this.on("click",'[data-action="playVideoInIframe"]',this.playVideoInIframe),this.on("input","#chatInputArea textarea",this.autoGrowTextarea),"roomChat"==this.scope.closest(".bimChatbox").attr("id")?(this.bim1=this.scope.attr("data-roomID"),this.bim2=ips.getSetting("chatbox_"+this.bim1)):(this.bim1=this.scope.attr("data-conID"),this.bim2=ips.getSetting("chatbox_conversations"))},autoGrowTextarea:function(i){var e=t(i.currentTarget),a=this.bim2.length;if(a>0){var o=e.val().length,s=this.scope.find(".charCount");s.text(o+"/"+a),0==o?s.hide():(s.show(),o<=a?s.hasClass("isOver")&&s.removeClass("isOver"):s.hasClass("isOver")||s.addClass("isOver"))}var r=e.closest(".bimChatbox").height(),n=e.closest("#chatInputArea"),h=e.height();e.css("height","auto").css("height",e[0].scrollHeight+"px");var c=e.height();if(n.hasClass("expanded")?e.val().length<e.data("maxLength")&&(n.removeClass("expanded"),e.removeData("maxLength")):c>=34&&19==h&&(n.addClass("expanded"),e.css("height","auto").css("height",e[0].scrollHeight+"px"),e.data("maxLength",e.val().length)),e.closest(".inGlobalChat").length>1)t(".chatBar").trigger("resizeBar");else{var d=e.closest(".bimChatbox").find(".ipsScrollbar"),l=e.closest(".bimChatbox").height();l>r?d.height(d.height()-(l-r)):e.closest(".bimChatbox").height()<r&&d.height(d.height()+(r-l))}},emoji:function(i){var e=t(i.currentTarget);this.scope.find("#"+e.attr("id")+"_menu").length||(t("body").append(ips.templates.render("chatbox.emoticons",{id:e.attr("id"),editor:"chatboxEditor_"+this.bim1})),t("#"+e.attr("id")+"_menu").addClass("chatboxEmojiMenu"),t(document).trigger("contentChange",[t("#"+e.attr("id")+"_menu")]),e.ipsMenu({alignCenter:!0,closeOnClick:!1}))},playVideoInPopup:function(i){t(i.currentTarget).attr("data-videoSource");var e=t(i.currentTarget).closest(".chat_row").attr("id"),a=t(i.currentTarget).attr("data-videoID");return t("body").append(ips.templates.render("chatbox.videoPopup",{chatID:e,videoID:a})),ips.ui.dialog.create({fixed:!1,size:"medium",forceReload:!0,content:".videopopup_"+e}).show(),this.stopPlayingVideos(),!1},playVideoInIframe:function(i){this.stopPlayingVideos();var e=t(i.currentTarget).attr("data-videoSource"),a=t(i.currentTarget).attr("data-videoID");if("youtube"==e)var o="//www.youtube.com/embed/"+a+"?autoplay=1";return t(i.currentTarget).closest(".chatboxVideo").html(ips.templates.render("chatbox.videoIframe",{play:o,id:a,source:e})),!1},stopPlayingVideos:function(){this.scope.find(".chatboxPlayer").each(function(){var i=t(this).attr("data-videoSource"),e=t(this).attr("data-videoID");if("youtube"==i)var a="//img.youtube.com/vi/"+e+"/mqdefault.jpg";t(this).closest(".chatboxVideoContainer").replaceWith(ips.templates.render("chatbox.parsedVideo",{source:i,id:e,img:a}))})},focusChatInput:function(){this.bim3=setInterval(i.bind(this.checkTyping,this),700)},blurChatInput:function(){clearInterval(this.bim3)},checkTyping:function(){var t=this.scope.find("#chatMSG").val();if(t!=this.bim4)if(0==t.indexOf("/giphy ")){this.bim4=t;var i=t.split(" ")[0].toLowerCase();this.cmdMedia(i)}else{var e=this.scope.find(".chatboxMedia");e.is(":visible")&&e.empty().hide()}},cmdMedia:function(i){var e=this;if("/giphy"==i){if("cmd"!=e.bim2.giphy&&"both"!=e.bim2.giphy)return!1;this._ajax&&this._ajax.abort&&this._ajax.abort();var a=e.scope.find(".chatboxMedia");return a.is(":visible")||a.show(),a.empty().addClass("ipsLoading"),this._ajax=ips.getAjax()(ips.getSetting("baseURL")+"index.php?app=core&module=system&controller=plugins&do=bimGiphy&editorId=giphyCMD",{data:{q:e.bim4.substring(i.length+1)},type:"post"}).done(function(i){a.html(i),t(document).trigger("contentChange",[e.scope.find(".chatboxMedia")])}).always(function(){a.removeClass("ipsLoading")}),!1}},bimGiphy:function(){if("roomChat"==this.scope.closest(".bimChatbox").attr("id"))var t="room";else t="convo";var e=ips.getSetting("baseURL")+"index.php?app=core&module=system&controller=plugins&do=bimGiphy&editorId=chatbox_"+t+"_"+this.bim1,a=ips.utils.db.get("bimgiphy_gif","recent"),o=null;return i.isArray(a)&&(o=JSON.stringify(a)),ips.ui.dialog.create({fixed:!1,size:"medium",title:ips.getString("bim_giphy"),url:e,forceReload:!0,ajax:{type:"post",data:{recent:o}}}).show(),!1}})}(jQuery,_),function(t,i,e){"use strict";ips.controller.mixin("bim.chatbox.emoji","core.global.editor.emoticons",!0,function(){this.before("insertEmoji",function(i){var e=this.editorID.split("_");if("chatboxEditor"==e[0]){var a=t(i.currentTarget).attr("data-emoji"),o=null;if(a.indexOf("custom-")>=0)o=t(i.currentTarget).find("img").attr("title");else{var s=t(i.currentTarget).find(".ipsEmoji");o=s.attr("src")&&null!=s.attr("src")?s.attr("alt"):t(i.currentTarget).find(".ipsEmoji").html()}if(t(".room_"+e[1]).length>0)var r=t(".room_"+e[1]).find("#chatMSG");else r=t(".convo_"+e[1]).find("#chatMSG");r.val(r.val()+" "+o),ips.utils.emoji.logUse(a)}})})}(jQuery,_);;
!function(t,e,i){"use strict";ips.controller.register("bim.chatbox.room",{bim1:null,bim2:null,bim3:null,bim4:null,bim5:null,bim6:null,bim7:null,bim8:null,bim9:null,bim10:null,bim11:null,bim12:null,bim13:12e4,_lastMSG:0,_joined:0,bim14:!0,bim15:!1,bim16:!0,bim17:!0,bim18:!1,bim19:!1,bim20:!1,bim21:!1,bim22:!1,bim23:!1,bim24:!1,bim25:!1,bim26:0,initialize:function(){this.configRoom(),this.on("menuItemSelected","#listRooms",this.listRooms),this.on("click",'[data-action="toggleChat"]',this.toggleChat),this.on(window,"resize",this.resizeWindow),0==this.scope.find(".chatboxIndentifyGuest").length&&0==this.scope.find(".chatboxRulesWrapper").length&&(this.on("click",'[data-action="connect"]',this.connect),this.on("click",'[data-action="chattersList"]',this.chattersList),this.on("menuItemSelected","#roomOptions"+this.bim2,this.roomOptions),this.on("click",'[data-action="msgOptions"]',function(t){return chatbox.toggleControlMSG(t),!1}),this.on("click",".chat_row",function(t){chatbox.hideAllControlMSG(t)}),this.on("click",'[data-action="deleteMSG"]',this.deleteMSG),this.on("click",'[data-action="reportMSG"]',this.reportMSG),this.on("click",'[data-action="mention"]',this.mention),this.on("click",'[data-action="addToBlockedList"]',this.addToBlockedList),this.bim1.use_editor?(this.on("submit",'[data-role="chatboxFormArea"] form',this.submitEditor),this.on("click",'[data-action="editMSG"]',this.editEditor)):(this.on("click",'[data-action="sendMSG"]',this.sendMSG),this.on("submit",'[data-action="chatForm"]',this.sendMSG),this.on("keypress","#chatInputArea textarea",this.submitCleanText),this.on("click",'[data-action="editMSG"]',this.editMSG),this.on("keypress",'[data-action="doEdit"]',this.doEdit)),this.scope.find("#chatContentIframe").on("scroll",e.bind(this.autoLoad,this)),this.startRoom()),this.scope.find(".chatboxIndentifyGuest").length>0&&(this.on("click",'[data-action="saveGuestName"]',this.saveGuestName),this.on("onsubmit",'[data-action="guestForm"]',this.saveGuestName)),this.scope.find(".chatboxRulesWrapper").length>0&&this.on("submit",".chatboxRulesWrapper form",this.acceptRules)},configRoom:function(){if(this.bim2=this.scope.attr("data-roomID"),this.bim1=ips.getSetting("chatbox_"+this.bim2),this.bim3=ips.getSetting("baseURL")+"index.php?app=chatbox&module=chatbox&controller=room&id="+this.bim2,this.bim8=ips.getSetting("lazyLoadEnabled")?ips.getSetting("blankImg"):null,this.bim4file=this.bim1.soundfile?this.bim1.soundfile:ips.getSetting("baseURL")+"applications/core/interface/sounds/notification.mp3",this.bim26=this.scope.find("#chatContentIframe").height(),t(".chatBoxFull").length){var e=t(".bimChatbox").height()-t("#chatContentIframe").height();t("#chatContentIframe").height(t(window).innerHeight()-e),t("#userListIframe").height(t(window).innerHeight()-e),t(".chatBoxFull").show(),t(window).resize(function(){t("#chatContentIframe").height(t(window).innerHeight()-e),t("#userListIframe").height(t(window).innerHeight()-e),t(".chatBoxFull").show()}),document.title=this.bim1.roomname}this.fixTheSize()},startRoom:function(){var e=this;ips.loader.get(["core/interface/howler/howler.core.min.js"]).then(function(){e.bim4=new Howl({src:e.bim4file,autoplay:!1})}),t(".convoList").length<=0&&moment.locale(ips.getSetting("chatbox_momentLocale")),this.bim1.musicbox&&this.jPlayer(),this.autoMessages(),this.ping(!0)},fixTheSize:function(){if(this.scope.closest(".chatBar").length>0){var e=!0;if(ips.getSetting("chatbox_bar_mini")&&(t.each(ips.getSetting("chatbox_bar_mini").split(","),function(t,i){if(ips.utils.responsive.currentIs(i.toLowerCase()))return e=!1,!1}),!e))return}else if(this.scope.closest(".chatboxWidget").length>0){e=!0;var i=this.scope.closest(".chatboxWidget");if(i.attr("data-automini")&&(t.each(i.attr("data-automini").split(","),function(t,i){if(ips.utils.responsive.currentIs(i.toLowerCase()))return e=!1,!1}),!e))return}this.toggleOn()},autoMessages:function(){var e=this.bim1.automsg;if(!e)return!1;var i=e.bot,a=(new Array,this);t.each(e.messages,function(e,o){i.content=o.msg,i.showAgoTime=Math.floor(Date.now()/1e3);var n=[i],s=a.scope.find("#chatContentIframe"),r=a.scope.find("#chatContent");setInterval(function(){if("asc"==a.bim1.sort){if(s.scrollTop()+s.innerHeight()-s.prop("scrollHeight")>=-30)var e=1;r.append(a.chatRowHTML(n)),t(document).trigger("contentChange",[r]),(1==e||a.bim23)&&a.goDown()}else r.prepend(a.chatRowHTML(n)),t(document).trigger("contentChange",[r]);if(a.bim1.limit>0&&!a.bim22){var i=r.children().length-a.bim1.limit;i>0&&r.find("li:nth"+("asc"==a.bim1.sort?"":"-last")+"-child(-n+"+i+")").remove()}1==ips.utils.cookie.get("chatbox_nosound_"+a.bim2)||a.bim17||a.bim21||a.bim4.play()},1e3*o.time)})},ping:function(t){var e=this;return!(e.scope.closest(".bimChatbox").hasClass("minimize")&&!e.bim1.alwaysON)&&(!(this.bim24&&!this.bim14)&&(1==t&&clearTimeout(e.bim7),void e.doPing(function(){e.bim7=setTimeout(function(){e.ping(!0)},e.bim13)})))},doPing:function(e){var i=this;return 0==t(".room_"+i.bim2).length?(i.stopUpdate(),!1):!i.bim15&&(i.bim15=!0,void ips.getAjax()(i.bim3+"&do=ping",{type:"post",dataType:"json"}).done(function(t){"error"==t.type?ips.ui.alert.show({message:t.message}):"errorGuestName"==t.type?(i.stopUpdate(),location.reload()):(i.bim14&&(i.updateChat(!0),i.bim14=!1),i.bim15=!1,"function"==typeof e&&e()),1!=i._joined&&(i._joined=1,i.bim3=i.bim3+"&joined="+i._joined)}).fail(function(){i.disconnect()}))},updateChat:function(t){var e=this;if(e.scope.closest(".bimChatbox").hasClass("minimize")&&!e.bim1.alwaysON)return!1;if(e.bim24&&!e.bim17)return!1;1==t&&clearTimeout(e.bim6);var i=e.bim1.interval>1e3?e.bim1.interval:1e3;e.doUpdateChat(function(){e.bim6=setTimeout(function(){e.updateChat(!0)},i)})},doUpdateChat:function(e){var i=this;if(0==t(".room_"+i.bim2).length)return i.stopUpdate(),!1;if(i.bim20||i.bim18)return!1;if(i.bim18=!0,"asc"==i.bim1.sort)var a=i._lastMSG>0?i._lastMSG:i.scope.find(".chat_row").last().attr("id");else a=i._lastMSG>0?i._lastMSG:i.scope.find(".chat_row").first().attr("id");ips.getAjax()(i.bim3+"&do=getMSG",{dataType:"json",data:{lastID:a||0,firstLoad:i.bim17?1:0,loadMoreMode:0,isReconnect:i.bim25?1:0}}).done(function(o){if("error"==o.type)ips.ui.alert.show({message:o.message});else{if("isBlocked"==o.type)return void i.kick();if(i.bim25&&i.connected(),i.scope.find(".colUserList").length>0)if(o.chatters){var n=Object.keys(o.chatters);if(i.bim1.theLastUser!=n[1]||i.bim17){i.bim1.theLastUser=n[1];var s=i.scope.find("#userList");s.html(i.chattersListFormat(o.chatters)),t(document).trigger("contentChange",[s])}}else i.bim1.theLastUser=0;if(i.bim17&&i.scope.find("#chatboxRoom .ipsLoading").removeClass("ipsLoading"),o.content&&a!=o.lastID){var r=i.scope.find("#chatContentIframe"),c=i.scope.find("#chatContent");if("asc"==i.bim1.sort){if(r.scrollTop()+r.innerHeight()-r.prop("scrollHeight")>=-30)var h=1;c.append(i.chatRowHTML(o.content)),t(document).trigger("contentChange",[r]),(1==h||i.bim23)&&i.goDown()}else c.prepend(i.chatRowHTML(o.content)),t(document).trigger("contentChange",[r]);if(o.updateAnn){var l=i.scope.find(".cbAnn");if("remove"==o.updateAnn)i.bim17||l.hide();else{l.show();var m=i.scope.closest(".bimChatbox").hasClass("inGlobalChat")||1!=o.updateAnn[2]?0:1;l.find(".annTitle").html(o.updateAnn[m])}}1==ips.utils.cookie.get("chatbox_nosound_"+i.bim2)||i.bim17||i.bim21||i.bim4.play(),c.find("img").imagesLoaded(function(t){i.bim17=!1}),i._lastMSG=o.lastID}o.update&&t.each(o.update,function(t,e){e?i.scope.find("#"+t+" .chatbox_msg").html(i.parseContent(e)):i.scope.find("#"+t).remove()}),1==i.bim1.musicbox&&(o.song?i.bim17||(o.song.id!=i.bim9&&(i.bim1.song=o.song),i.playSong()):i.hideMusicPlayer())}i.bim18=!1,"function"==typeof e&&e()}).fail(function(){i.disconnect()}).always(function(t){i.bim23=!1,i.bim21=!1})},sendMSG:function(e){e.preventDefault();var i=this;if(i.bim20||i.bim19)return!1;var a=chatbox.escapeHTML(i.scope.find("#chatMSG").val());return 0!=i.checkMSG(a)&&0!=i.checkFlood()&&(i.toggleInputForm(0),ips.getAjax()(i.bim3+"&do=sendMSG",{type:"post",dataType:"json",data:{msg:a}}).done(function(e){"error"==e.type?ips.ui.alert.show({message:e.message}):"errorGuestName"==e.type?(i.stopUpdate(),location.reload()):(i.bim21=!0,i.updateChat(!0),i.bim1.lastchat=t.now())}).always(function(t){i.bim22=!1,i.bim19=!1,i.bim23=!0,i.toggleInputForm(1),i.scope.find(".charCount").hide()}),!1)},submitCleanText:function(e){if(13===e.which)return t(e.currentTarget).closest("form").submit(),!1},deleteMSG:function(e){var i=this,a=t(e.currentTarget).closest(".chat_row").attr("id");return ips.ui.alert.show({type:"confirm",message:ips.getString("chatbox_confirmDelete"),icon:"warn",buttons:{ok:ips.getString("chatbox_confirm_yes"),cancel:ips.getString("chatbox_confirm_cancel")},callbacks:{ok:function(){ips.getAjax()(i.bim3+"&do=deleteMSG",{type:"post",data:{chatID:a}}).done(function(i){"error"==i.type?ips.ui.alert.show({message:i.message}):(ips.ui.flashMsg.show(ips.getString("chatbox_deleted")),t(e.currentTarget).closest(".chat_row").remove())})}}}),!1},reportMSG:function(e){var i=t(e.currentTarget).closest(".chat_row").attr("id"),a=ips.ui.dialog.create({url:ips.getSetting("baseURL")+"index.php?app=chatbox&module=chatbox&controller=msg&do=report&id="+i,size:"normal",title:ips.getString("chatbox_report"),forceReload:!1,destructOnClose:!0,callback:function(e){t(e).find("form").on("submit",function(e){for(var i in e.preventDefault(),CKEDITOR.instances)CKEDITOR.instances[i].updateElement();var o=t(e.currentTarget);return ips.getAjax()(o.attr("action"),{data:o.serialize(),type:"post",bypassRedirect:!0}).done(function(t){ips.ui.flashMsg.show(ips.getString("chatbox_sent_report"))}).always(function(t){a.hide()}),!1})}});return a.show(),!1},editMSG:function(e){var i=this,a=t(e.currentTarget).closest(".chat_row").attr("id"),o=i.scope.find("#chatRow_"+a),n=i.scope.find("#chatRow_"+a+" .chatbox_msg");return i.bim20?(o.find(".editChatInput").length>0&&(o.find(".editChatInput").remove(),n.show(),t(e.currentTarget).html('<i class="fa fa-pencil"></i>').attr("_title",ips.getString("chatbox_btn_edit")),i.bim20=!1,i.toggleInputForm(1)),!1):(ips.getAjax()(i.bim3+"&do=editMSG",{type:"post",data:{chatID:a}}).done(function(a){"error"==a.type?ips.ui.alert.show({message:a.message}):(t(e.currentTarget).html(ips.getString("chatbox_btn_cancel")).attr("_title",ips.getString("chatbox_btn_cancel")),n.after(ips.templates.render("chatbox.editInput")),n.hide(),o.find(".editChatInput").val(a.content).focus(),i.bim20=!0,i.toggleInputForm(0))}),!1)},doEdit:function(e){if(13==e.which){var i=this,a=t(e.currentTarget).closest(".chat_row").attr("id"),o=i.scope.find("#chatRow_"+a),n=i.scope.find("#chatRow_"+a+" .chatbox_msg"),s=chatbox.escapeHTML(t(e.currentTarget).val());return 0!=i.checkMSG(s)&&(ips.getAjax()(i.bim3+"&do=doEdit",{type:"post",data:{chatID:a,msg:s}}).done(function(e){"error"==e.type?ips.ui.alert.show({message:e.message}):(ips.ui.flashMsg.show(ips.getString("chatbox_edited")),n.show().html(i.parseContent(e.content)),o.find(".editChatInput").remove(),i.scope.find("#"+a).find(".editBtn").html('<i class="fa fa-pencil"></i>').attr("_title",ips.getString("chatbox_btn_edit")),t(document).trigger("contentChange",[i.scope.find(".chatboxContainer")]),i.bim20=!1,i.updateChat(!0))}).always(function(t){i.toggleInputForm(1)}),!1)}},chatRowHTML:function(e){var i=this,a="",o="",n="",s="chatbox.style."+this.bim1.style;return t.each(e,function(t,e){var r=e.id>0?e.id:0;if(!(r>0&&i.scope.find("#chatRow_"+r).length>0))if(-1!=e.chatterID){var c=!(!i.bim1.canManage||e.chatterID==ips.getSetting("chatbox_member_id"));e.chatterID>0&&(n=ips.getSetting("baseURL")+"index.php?app=core&module=members&controller=profile&id="+e.chatterID,o=n+"&do=hovercard"),a+=ips.templates.render(s,{id:r,chatterID:e.chatterID,chatterName:e.chatterName,chatterKey:e.chatterKey,chatterNameFormat:e.chatterNameFormat,chatterPhoto:e.chatterID>0?e.chatterPhoto:"https://www.gravatar.com/avatar/"+e.chatterPhoto+"?s=32&d=wavatar&r=PG",chatterUrl:n,chatterIP:e.chatterIP,memberHovercard:o,content:i.parseContent(e.content),callme:-1!=e.content.indexOf("@"+ips.getSetting("chatbox_member_name")),isMe:e.chatterName==ips.getSetting("chatbox_member_name"),showAgoTime:e.showAgoTime,showDate:e.showDate,canEdit:e.canEdit,canDelete:e.canDelete,canReport:e.canReport,canBeBlocked:c,canManageMSG:e.canEdit||e.canDelete||e.canReport||c})}else a+=ips.templates.render("chatbox.style.system",{id:e.id,content:e.content,showAgoTime:e.showAgoTime,showDate:e.showDate,canDelete:e.canDelete})}),""==a&&(i.bim21=!0),a},parseContent:function(t){return this.bim1.use_editor?t:chatbox.parseContent(t,this.bim1.allow_img,this.bim1.allow_video)},chattersListFormat:function(e){var i="",a="",o="",n=this;return t.each(e,function(t,e){var s=!(!n.bim1.canManage||e.chatterID==ips.getSetting("chatbox_member_id"));e.chatterID>0&&(o=ips.getSetting("baseURL")+"index.php?app=core&module=members&controller=profile&id="+e.chatterID,a=o+"&do=hovercard"),e.is_anon&&n.bim1.hideAnon&&!n.bim1.canManage&&e.chatterID!=ips.getSetting("chatbox_member_id")||(i+=ips.templates.render("chatbox.chatter.row",{chatterKey:e.key,chatterID:e.chatterID,chatterIP:e.ip,chatterName:e.chatterName,chatterNameFormat:e.chatterNameFormat,chatterPhoto:e.chatterID>0?e.chatterPhoto:"https://www.gravatar.com/avatar/"+e.chatterPhoto+"?s=32&d=wavatar&r=PG",chatterUrl:e.chatterUrl,memberHovercard:a,canBeBlocked:s,privateChat:e.privateChat,isbim27:n.bim1.hideAnon?e.is_anon:null}))}),i},chattersList:function(e){t("#chattersList_"+this.bim2+"_menu").length||t(".chatboxContainer").append(ips.templates.render("chatbox.chatters.list",{roomID:this.bim2}));var i=this;ips.getAjax()(i.bim3+"&do=chattersList",{type:"post",dataType:"json"}).done(function(e){"error"==e.type&&ips.ui.alert.show({message:e.message});var a=i.scope.find(".chatbox_chatters_Panel");a.hasClass("ipsLoading")&&a.removeClass("ipsLoading"),a.find(".ipsDataList").html(i.chattersListFormat(e.list)),t(document).trigger("contentChange",[a])})},listRooms:function(e,i){(e=i?i.originalEvent:e).preventDefault();switch(t(e.target).attr("data-action")){case"changeRoom":this.changeRoom(e,i)}},changeRoom:function(e,i){i.originalEvent.preventDefault();var a=this,o=t(e.target).attr("data-newroom"),n=t(e.target).closest(".bimChatbox").hasClass("inGlobalChat")?1:0,s=t(e.target).closest(".cWidgetContainer").length>0?a.scope.closest(".cWidgetContainer").attr("data-orientation"):"",r=t(e.target).closest(".bimChatbox").hasClass("minimize");return ips.getAjax()(a.bim3+"&do=changeRoom",{type:"post",dataType:"json",data:{newroom:o,inGlobal:n,inWidget:s}}).done(function(e){"error"==e.type?ips.ui.alert.show({message:e.message}):e.url?window.location.replace(e.url):(a.stopUpdate(),a.scope.closest(".bimChatbox").replaceWith(e.html),r||t(".room_"+o).removeClass("minimize"),ips.setSetting("chatbox_"+o,e.config),t(document).trigger("contentChange",[t(".room_"+o)]),t(".chatBar").trigger("resizeBar"))}),!1},roomOptions:function(e,i){(e=i?i.originalEvent:e).preventDefault();switch(t(e.target).attr("data-action")){case"toggleSound":this.toggleSound(i);break;case"openWindowTab":this.openWindowTab(e,i);break;case"cleanRoom":this.cleanRoom(i);break;case"makeAnnouncement":this.makeAnnouncement(i);break;case"blockedChatters":this.blockedChatters(i);break;case"changeSkin":this.changeSkin(e,i);break;case"selectSong":this.selectSong(e,i);break;case"archive":window.open(t(e.target).attr("href"),"_blank")}},toggleSound:function(e){e.originalEvent.preventDefault();var i=ips.utils.cookie.get("chatbox_nosound_"+this.bim2);this.scope.find('[data-action="toggleSound"] .fa').replaceWith(t("<i/>").addClass("fa").addClass(1!=i?"fa-volume-off":"fa-volume-up").removeClass(1!=i?"fa-volume-up":"fa-volume-off")),1==i?ips.utils.cookie.set("chatbox_nosound_"+this.bim2,0):ips.utils.cookie.set("chatbox_nosound_"+this.bim2,1),ips.ui.flashMsg.show(ips.utils.cookie.get("chatbox_nosound_"+this.bim2)?ips.getString("chatbox_soundDisabled"):ips.getString("chatbox_soundEnabled"))},openWindowTab:function(e,i){i.originalEvent.preventDefault();var a=t(e.target).closest(".bimChatbox"),o=t(e.target).attr("href");if(o){var n=a.width(),s=a.height(),r=t(window).width()/2-n/2,c=t(window).height()/2-s/2;if(this.bim1.use_editor)var h="directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,width="+n+",height="+(s+=25)+",top="+c+", left="+r;else h="directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width="+n+",height="+s+",top="+c+", left="+r;window.open(o,"chatInPopup",h)}return!1},cleanRoom:function(t){t.originalEvent.preventDefault();var e=this;return ips.ui.alert.show({type:"confirm",message:ips.getString("chatbox_confirmClean"),icon:"warn",buttons:{ok:ips.getString("chatbox_confirm_yes"),cancel:ips.getString("chatbox_confirm_cancel")},callbacks:{ok:function(){ips.getAjax()(e.bim3+"&do=cleanRoom").done(function(t){"error"==t.type?ips.ui.alert.show({message:t.message}):(ips.ui.flashMsg.show(ips.getString("chatbox_deleted_all")),e.scope.find("#chatContent").empty())})}}}),!1},makeAnnouncement:function(e){e.originalEvent.preventDefault();var i=this,a=ips.ui.dialog.create({url:i.bim3+"&do=makeAnnouncement",size:"normal",title:ips.getString("chatbox_announcement"),forceReload:!1,destructOnClose:!0,callback:function(){t(".chatboxAnnForm").on("submit",function(e){for(var o in e.preventDefault(),CKEDITOR.instances)CKEDITOR.instances[o].updateElement();var n=t(e.currentTarget);return ips.getAjax()(n.attr("action"),{data:n.serialize(),type:"post",bypassRedirect:!0}).done(function(t){"error"==t.type?ips.ui.alert.show({message:t.message}):(t.title?(i.scope.find(".cbAnn").show(),i.scope.find(".cbAnn .annTitle").text(t.title)):i.scope.find(".cbAnn").hide(),i.updateChat(!0))}).always(function(t){a.hide()}),!1})}});return a.show(),!1},blockedChatters:function(e){e.originalEvent.preventDefault();var i=this;return ips.ui.dialog.create({url:i.bim3+"&do=blockedChatters",size:"normal",title:ips.getString("chatbox_blockedchatters"),forceReload:!0,destructOnClose:!0,callback:function(){t("[data-action='unblock']").on("click",function(e){return ips.getAjax()(i.bim3+"&do=unblock",{type:"post",data:{key:t(e.currentTarget).attr("data-key")}}).done(function(i){"error"==i.type?ips.ui.alert.show({message:i.message}):t(e.currentTarget).closest(".userRow").remove()}),!1})}}).show(),!1},addToBlockedList:function(e){e.preventDefault();var i=this,a=t(e.currentTarget).attr("data-key"),o=t(e.currentTarget).attr("data-ip"),n=t(e.currentTarget).attr("data-name"),s=ips.ui.dialog.create({url:i.bim3+"&do=addToBlockedList&key="+a+"&ip="+o+"&name="+n,size:"narrow",forceReload:!0,destructOnClose:!0,callback:function(){t(".chatboxBlockUser").on("submit",function(o){o.preventDefault();var n=t(o.currentTarget);return ips.getAjax()(n.attr("action"),{data:n.serialize(),type:"post",bypassRedirect:!0}).done(function(o){ips.ui.flashMsg.show(o.message),1==o.deleted?(t(e.currentTarget).closest(".chatter_row").remove(),i.scope.find("[data-key='"+a+"']").closest(".chat_row").remove()):t(e.currentTarget).closest(".chatter_row").remove()}).always(function(t){s.hide()}),!1})}});return s.show(),!1},changeSkin:function(e,i){i.originalEvent.preventDefault();var a=t(e.target).data("skin");return t(e.target).closest(".chatboxSkins").find("li").removeClass("skinSelected"),t(e.target).addClass("skinSelected"),t(e.target).closest(".bimChatbox").removeClass(function(t,e){return(e.match(/(^|\s)skin_\S+/g)||[]).join(" ")}),t(e.target).closest(".bimChatbox").addClass("skin_"+a),ips.utils.cookie.set("chatbox_skin_"+this.bim2,a),!1},disconnect:function(){return this.bim25?(ips.ui.alert.show({message:ips.getString("chatbox_can_not_connect")}),this.scope.find("#btnConnect").html(ips.getString("chatbox_reconnect")),this.scope.find("#btnConnect").attr("disabled",!1),!1):(this.stopUpdate(),this.bim25=!0,this.scope.prepend(ips.templates.render("chatbox.disconnected",{msg:ips.getString("chatbox_disconnected"),btn:ips.getString("chatbox_reconnect")})),!1)},connect:function(){return this.scope.find("#btnConnect").attr("disabled",!0),this.scope.find("#btnConnect").html('<i class="fa fa-refresh fa-spin"></i> '+ips.getString("chatbox_connecting")),this.bim18=!1,this.updateChat("true"),!1},connected:function(){this.bim25=!1,this.scope.find(".disconnected").remove(),ips.ui.flashMsg.show(ips.getString("chatbox_connected"))},kick:function(){return this.stopUpdate(),this.bim25=!0,this.scope.prepend(ips.templates.render("chatbox.disconnected",{msg:ips.getString("chatbox_isblocked")})),!1},toggleInputForm:function(e){var i=this.scope.find("#chatMSG"),a=this.scope.find('[data-action="sendMSG"]');1==e?(this.bim19=!1,a.prop("disabled",!1),i.val(""),i.closest("form").hasClass("expanded")&&(i.closest("form").removeClass("expanded"),i.css("height","auto"),this.scope.find("#chatContentIframe").height(this.bim26),this.scope.find("#userListIframe").height(this.bim26),t(".chatBar").trigger("resizeBar"))):(this.bim19=!0,a.prop("disabled",!0))},toggleChat:function(){return this.scope.closest(".bimChatbox").hasClass("minimize")?(ips.utils.cookie.set("chatbox_off_"+this.bim2,0),this.scope.closest(".bimChatbox").removeClass("minimize"),ips.getSetting("chatbox_member_name")&&1!=this.scope.find(".chatboxRulesWrapper").length&&(this.ping(!0),this.bim17||this.updateChat(!0)),t(".chatBar").trigger("resizeBar")):(ips.utils.cookie.set("chatbox_off_"+this.bim2,1),this.scope.closest(".bimChatbox").addClass("minimize"),this.stopUpdate(),this.bim12=t.now()),!1},toggleOn:function(){1==ips.utils.cookie.get("chatbox_off_"+this.bim2)&&this.scope.find('.miniTitle [data-action="toggleChat"]').closest("li").is(":visible")||this.scope.closest(".bimChatbox").hasClass("minimize")&&this.toggleChat()},stopUpdate:function(){clearTimeout(this.bim6),clearTimeout(this.bim7)},autoLoad:function(e){if(!this.bim1.autoload||this.bim17||!this.bim16)return!1;var i=this,a=t(e.currentTarget),o=a.find("#chatContent");if("asc"==this.bim1.sort){if(0!=a.scrollTop())return!1;var n=o.children().first().attr("id")}else{if(a.scrollTop()+a.innerHeight()<a[0].scrollHeight)return!1;n=o.children().last().attr("id")}if(a.find("#loadMore").length<=0){var s=ips.templates.render("chatbox.loadMore");"asc"==this.bim1.sort?o.prepend(s):o.append(s)}i.bim16=!1,i.bim22=!0,ips.getAjax()(i.bim3+"&do=getMSG",{dataType:"json",data:{lastID:n||0,loadMoreMode:1}}).done(function(e){"error"==e.type?ips.ui.alert.show({message:e.message}):e.content?("asc"==i.bim1.sort?(o.prepend(i.chatRowHTML(e.content)),a.scrollTop(i.scope.find("#"+n).position().top-50)):o.append(i.chatRowHTML(e.content)),t(document).trigger("contentChange",[i.scope.find("#chatContentIframe")]),i.bim16=!0):i.bim16=!1,a.find("#loadMore").remove()}).fail(function(){i.disconnect()}).always(function(){i.bim21=!1})},saveGuestName:function(e){e.preventDefault();var i=this,a=i.scope.closest(".bimChatbox").hasClass("inGlobalChat")?1:0,o=i.scope.closest(".cWidgetContainer").length>0?i.scope.closest(".cWidgetContainer").attr("data-orientation"):"",n=i.scope.find("button");n.attr("disabled",!0),n.html('<i class="fa fa-refresh fa-spin"></i> '+ips.getString("chatbox_connecting"));var s=i.scope.find(".guestName").val();return ips.getAjax()(i.bim3+"&do=changeName",{type:"post",dataType:"json",data:{name:s,inGlobal:a,inWidget:o}}).done(function(e){"error"==e.type||"errorGuestName"==e.type?ips.ui.alert.show({message:e.message}):(i.scope.closest(".bimChatbox").replaceWith(e.html),1==a&&(t(".room_"+i.bim2).removeClass("minimize"),t(document).trigger("contentChange",[t(".room_"+i.bim2)]),t(".chatBar").trigger("resizeBar")),t(document).trigger("contentChange",[t(".room_"+i.bim2)]),ips.ui.flashMsg.show(e.message))}).always(function(){n.attr("disabled",!1),n.html(ips.getString("chatbox_save_name"))}),!1},acceptRules:function(e){e.preventDefault();var i=this,a=t(e.currentTarget),o=i.scope.closest(".bimChatbox").hasClass("inGlobalChat")?1:0,n=i.scope.closest(".cWidgetContainer").length>0?i.scope.closest(".cWidgetContainer").attr("data-orientation"):"",s=i.scope.closest(".chatBar").length>0?1:0;return ips.getAjax()(a.attr("action"),{data:a.serialize()+"&inGlobal="+o+"&inWidget="+n+"&openFromBar="+s,type:"post",bypassRedirect:!0}).done(function(e){"error"==e.type?ips.ui.alert.show({message:e.message}):(i.scope.closest(".bimChatbox").replaceWith(e.html),1==o&&t(".room_"+i.bim2).removeClass("minimize"),t(document).trigger("contentChange",[t(".room_"+i.bim2)]),t(".chatBar").trigger("resizeBar"))}),!1},mention:function(t){return t.preventDefault(),chatbox.mention(t,this.bim1.use_editor),!1},submitEditor:function(e){e.preventDefault();var i=this,a=t(e.currentTarget);if(i.bim20||i.bim19)return!1;var o=CKEDITOR.instances["chatMSG_"+i.bim2].getData();if(0==i.checkMSG(o)||0==i.checkFlood())return!1;a.find('button[type="submit"]').prop("disabled",!0).text(ips.getString("chatbox_posting")),i.bim19=!0,ips.getAjax()(a.attr("action"),{data:a.serialize(),type:"post",bypassRedirect:!0}).done(function(e){"error"==e.type?(ips.ui.alert.show({message:e.message}),i.bim19=!1):"errorGuestName"==e.type?(i.stopUpdate(),location.reload()):(ips.ui.editor.getObj(i.scope.find('[data-role="chatboxFormArea"] [data-ipsEditor]')).reset(),i.bim21=!0,i.updateChat(!0),i.bim1.lastchat=t.now(),t(".chatBar").trigger("resizeBar"))}).always(function(){a.find('button[type="submit"]').prop("disabled",!1).text(ips.getString("chatbox_send")),i.bim19=!1,i.bim22=!1,i.bim23=!0})},editEditor:function(e){var i=this,a=t(e.currentTarget).closest(".chat_row").attr("id"),o=t(".room_"+i.bim2),n=ips.ui.dialog.create({url:i.bim3+"&do=editEditor&chatID="+a,size:"normal",title:ips.getString("chatbox_edit"),forceReload:!0,destructOnClose:!0,callback:function(){t(".ipsDialog_content #elChatboxEditor").find("form").on("submit",function(e){if(e.preventDefault(),i.bim20)return!1;i.bim20=!0;var s=CKEDITOR.instances["chatMSG_"+i.bim2+"_"+a];s.updateElement();var r=s.getData();if(0==i.checkMSG(r))return!1;var c=t(e.currentTarget);return ips.getAjax()(c.attr("action"),{data:c.serialize(),type:"post",bypassRedirect:!0}).done(function(e){"error"==e.type?ips.ui.alert.show({message:e.message}):(ips.ui.flashMsg.show(ips.getString("chatbox_edited")),o.find("#chatRow_"+a+" .chatbox_msg").html(i.parseContent(e.content)),t(document).trigger("contentChange",[o.find(".chatboxContainer")]),i.updateChat(!0))}).always(function(t){n.hide(),i.bim20=!1}),!1})}});return n.show(),!1},checkFlood:function(){if(this.bim1.flood>0&&!this.bim1.canManage&&!this.bim1.canBypassFlood){var e=(t.now()-this.bim1.lastchat)/1e3;if(e<this.bim1.flood)return ips.ui.alert.show({message:ips.getString("chatbox_error_flood",{time:(this.bim1.flood-e).toFixed(2)})}),0}return 1},checkMSG:function(t){t=t.trim();var e=this.bim1.length;return t.length<=0?(ips.ui.alert.show({message:ips.getString("chatbox_error_empty")}),0):e>0&&t.length>e?(ips.ui.alert.show({message:ips.pluralize(ips.getString("chatbox_error_maxlength"),e)}),0):1},selectSong:function(i){i.originalEvent.preventDefault();var a=this;return ips.ui.dialog.create({url:a.bim3+"&do=selectSong",size:"narrow",title:ips.getString("chatbox_selectSong"),forceReload:!0,destructOnClose:!0,callback:function(){t(document).on("click",'[data-action="addSong"]',e.bind(a.addSong,a)),t(document).on("click",'[data-action="removeSong"]',e.bind(a.removeSong,a)),t(document).on("focus",'[data-role="searchSong"]',e.bind(a.focusSongSearch,a)),t(document).on("blur",'[data-role="searchSong"]',e.bind(a.blurSongSearch,a))}}).show(),!1},focusSongSearch:function(t){this.bim10=setInterval(e.bind(this._checkSongValue,this),700)},blurSongSearch:function(t){clearInterval(this.bim10)},_checkSongValue:function(){var e=t('[data-role="searchSong"]').val();if(!(e==this.bim11||e.length<4)){this.bim11=e,this._ajax&&this._ajax.abort&&this._ajax.abort();this._ajax=ips.getAjax()(this.bim3+"&do=searchSong",{data:{q:this.bim11},type:"post"}).done(function(e){t('[data-role="songResults"]').html(e),t(document).trigger("contentChange",[t('[data-role="songResults"]')])})}},addSong:function(e){t(e.currentTarget).closest(".ipsDataItem").attr("data-songID");var i=this;return this._ajax=ips.getAjax()(i.bim3+"&do=addSong",{data:{song:t(e.currentTarget).closest(".ipsDataItem").attr("data-songID")},type:"post"}).done(function(a){if("error"==a.type)ips.ui.alert.show({message:a.message});else{var o=t(e.currentTarget).closest(".chatboxSongs").find('[data-role="playingSong"]');o.html(a.html),t(document).trigger("contentChange",[o]);var n=t.parseJSON(a.song);n.id!=i.bim9&&(i.bim1.song=n),i.playSong()}}),!1},removeSong:function(e){t(e.currentTarget).closest(".ipsDataItem").attr("data-songID");var i=this;return this._ajax=ips.getAjax()(i.bim3+"&do=removeSong",{data:{song:t(e.currentTarget).closest(".ipsDataItem").attr("data-songID")},type:"post"}).done(function(a){"error"==a.type?ips.ui.alert.show({message:a.message}):(t(e.currentTarget).closest(".chatboxSongs").find('[data-role="playingSong"]').html(""),i.hideMusicPlayer())}),!1},playSong:function(){if(!this.bim1.song)return!1;var e=t.parseJSON(this.bim1.song),i=t(".room_"+this.bim2),a=i.find("#chatbox-player");if(this.bim9>0&&this.bim9==e.id)return!1;this.bim9=e.id,i.find(".chatboxMusicPlayer").removeClass("ipsHide"),a.jPlayer("stop"),i.find("#current-song-name").html(e.name),i.find("#current-artist-name").html(e.artist),i.find("#topbar-artwork").html('<img src="'+e.thumbnail+'">'),e.file.toLowerCase().indexOf(".mp3")>=0?a.jPlayer("setMedia",{mp3:e.file}).jPlayer("play",1):e.file.toLowerCase().indexOf("m4a")>=0?a.jPlayer("setMedia",{m4a:e.file}).jPlayer("play",1):e.file.toLowerCase().indexOf("wma")>=0&&a.jPlayer("setMedia",{wma:e.file}).jPlayer("play",1)},hideMusicPlayer:function(){this.scope.find("#chatbox-player").jPlayer("stop"),this.scope.find(".chatboxMusicPlayer").addClass("ipsHide"),self.bim9=0},jPlayer:function(){this.scope.find("#chatbox-player").length&&(this.scope.find("#chatbox-player").jPlayer({cssSelectorAncestor:"#sound-container",swfPath:ips.getSetting("baseURL")+"applications/musicbox/interface/jPlayer",supplied:"mp3,wma,m4a",wmode:"window",volume:ips.utils.db.get("musicbox","volume")?ips.utils.db.get("musicbox","volume"):.5,smoothPlayBar:!0,consoleAlerts:!1,loop:!0}),this.playSong())},resizeWindow:function(){this.scope.closest(".chatBar").length>0&&(this.scope.closest(".chatBar").is(":hidden")?(this.bim24||this.toggleChat(),this.bim24=!0):this.bim24=!1)},goDown:function(){var t=this,e=t.scope.find("#chatContentIframe"),i=t.scope.find("#chatContent");t.bim22||e.scrollTop(e.prop("scrollHeight")),t.bim8?ips.utils.lazyLoad.observe(i,{imgLoadedCallback:function(){t.bim22||e.scrollTop(e.prop("scrollHeight"))}}):e.find("img").imagesLoaded(function(i){t.bim22||e.scrollTop(e.prop("scrollHeight"))})}})}(jQuery,_);;
ips.templates.set('chatbox.style.standard'," <li class='ipsDataItem {{#id}}chat_row{{/id}} chatbox_style1 {{#callme}}mentionMe{{/callme}}' {{#id}}id='{{id}}'{{/id}}> <div class='ipsPad_half {{#chatterPhoto}}ipsPhotoPanel ipsPhotoPanel_tiny{{/chatterPhoto}} ipsClearfix'>  <a href='#' data-member='{{chatterName}}' data-id='{{chatterID}}' data-url='{{chatterUrl}}' {{#memberHovercard}}data-ipshover data-ipshover-target='{{memberHovercard}}' data-ipsHover-onClick{{/memberHovercard}} class='ipsUserPhoto ipsUserPhoto_tiny' id='ips_uid_{{chatterID}}'>   <img src='{{chatterPhoto}}' alt=''>  </a>  <div>   <a href='#' class='chatter_name' data-action='mention' data-member='{{chatterName}}' data-id='{{chatterID}}' data-url='{{chatterUrl}}' {{#memberHovercard}}data-ipshover data-ipshover-target='{{memberHovercard}}'{{/memberHovercard}}>{{{chatterNameFormat}}}</a>   <div class='ipsPos_right'>    <span {{#showAgoTime}}data-livestamp='{{showAgoTime}}'{{/showAgoTime}} class='cbTime ipsType_small ipsType_light'>     {{#showDate}}{{showDate}}{{/showDate}}    </span>&nbsp;    {{#id}}     {{#canManageMSG}}<span class='msgOptions ipsType_light' data-action='msgOptions' title='{{#lang}}chatbox_mana_msg{{/lang}}'><i class='fa fa-ellipsis-h'></i></span>{{/canManageMSG}}     {{#canEdit}}<span class='msgManageBtn editBtn' data-action='editMSG' title='{{#lang}}chatbox_edit{{/lang}}'><i class='fa fa-pencil'></i></span>{{/canEdit}}     {{#canDelete}}<span class='msgManageBtn deleteBtn' data-action='deleteMSG' title='{{#lang}}chatbox_delete{{/lang}}'><i class='fa fa-times'></i></span>{{/canDelete}}     {{#canReport}}<span class='msgManageBtn reportBtn' data-action='reportMSG' title='{{#lang}}chatbox_report{{/lang}}'><i class='fa fa-exclamation'></i>a</span>{{/canReport}}     {{#canBeBlocked}}<span class='msgManageBtn blockBtn' data-action='addToBlockedList' data-key='{{chatterKey}}' data-ip='{{chatterIP}}' data-name='{{chatterName}}' title='{{#lang}}chatbox_block{{/lang}}'><i class='fa fa-ban'></i></span>{{/canBeBlocked}}    {{/id}}   </div>   <div class='ipsList_inline' id='chatRow_{{id}}' data-id='{{id}}'><span class='chatbox_msg'>{{{content}}}</span></div>  </div> </div></li>");ips.templates.set('chatbox.style.condensed'," <li class='ipsDataItem {{#id}}chat_row{{/id}} chatbox_style2 {{#callme}}mentionMe{{/callme}}' {{#id}}id='{{id}}'{{/id}}> <div class='ipsPad_half ipsClearfix'>  <a href='#' class='chatter_name' data-action='mention' data-member='{{chatterName}}' data-id='{{chatterID}}' data-url='{{chatterUrl}}'>{{{chatterNameFormat}}}</a>:    <span class='ipsPos_right'>   <span {{#showAgoTime}}data-livestamp='{{showAgoTime}}'{{/showAgoTime}} class='cbTime ipsType_small ipsType_light'>    {{#showDate}}{{showDate}}{{/showDate}}   </span>&nbsp;   {{#id}}    {{#canManageMSG}}<span class='msgOptions ipsType_light' data-action='msgOptions' title='{{#lang}}chatbox_mana_msg{{/lang}}'><i class='fa fa-ellipsis-h'></i></span>{{/canManageMSG}}    {{#canEdit}}<span class='msgManageBtn editBtn' data-action='editMSG'  title='{{#lang}}chatbox_edit{{/lang}}'><i class='fa fa-pencil'></i></span>{{/canEdit}}    {{#canDelete}}<span class='msgManageBtn deleteBtn' data-action='deleteMSG'  title='{{#lang}}chatbox_delete{{/lang}}'><i class='fa fa-times'></i></span>{{/canDelete}}    {{#canReport}}<span class='msgManageBtn reportBtn' data-action='reportMSG'  title='{{#lang}}chatbox_report{{/lang}}'><i class='fa fa-exclamation'></i>a</span>{{/canReport}}    {{#canBeBlocked}}<span class='msgManageBtn blockBtn' data-action='addToBlockedList'  data-key='{{chatterKey}}' data-ip='{{chatterIP}}' data-name='{{chatterName}}' title='{{#lang}}chatbox_block{{/lang}}'><i class='fa fa-ban'></i></span>{{/canBeBlocked}}   {{/id}}  </span>  <span id='chatRow_{{id}}' data-id='{{id}}'><span class='chatbox_msg'>{{{content}}}</span></span> </div></li>");ips.templates.set('chatbox.style.bubbles'," <li class='ipsDataItem {{#id}}chat_row{{/id}} chatbox_style3 {{#callme}}mentionMe{{/callme}}' {{#id}}id='{{id}}'{{/id}}> <div class='ipsPad_half {{#chatterPhoto}}ipsPhotoPanel ipsPhotoPanel_tiny{{/chatterPhoto}} ipsClearfix'>  <a href='#' data-member='{{chatterName}}' data-id='{{chatterID}}' data-url='{{chatterUrl}}' {{#memberHovercard}}data-ipshover data-ipshover-target='{{memberHovercard}}' data-ipsHover-onClick{{/memberHovercard}} class='ipsUserPhoto ipsUserPhoto_tiny' id='ips_uid_{{chatterID}}'>   <img src='{{chatterPhoto}}' alt=''>  </a>  <div class='ipsClearfix'>   <div class='bubble cb1' id='chatRow_{{id}}' data-id='{{id}}'>    <a href='#' class='chatter_name' class='chatterName ipsType_reset' data-action='mention' data-member='{{chatterName}}' data-id='{{chatterID}}' data-url='{{chatterUrl}}' {{#memberHovercard}}data-ipshover data-ipshover-target='{{memberHovercard}}'{{/memberHovercard}}>{{{chatterNameFormat}}}:</a>     <span class='chatbox_msg'>{{{content}}}</span>   </div>   <br>   <span class='ipsPos_right'>    <span {{#showAgoTime}}data-livestamp='{{showAgoTime}}'{{/showAgoTime}} class='cbTime ipsType_small ipsType_light'>     {{#showDate}}{{showDate}}{{/showDate}}    </span>&nbsp;    {{#id}}     {{#canManageMSG}}<span class='msgOptions ipsType_light' data-action='msgOptions' title='{{#lang}}chatbox_mana_msg{{/lang}}'><i class='fa fa-ellipsis-h'></i></span>{{/canManageMSG}}     {{#canEdit}}<span class='msgManageBtn editBtn' data-action='editMSG'  title='{{#lang}}chatbox_edit{{/lang}}'><i class='fa fa-pencil'></i></span>{{/canEdit}}     {{#canDelete}}<span class='msgManageBtn deleteBtn' data-action='deleteMSG'  title='{{#lang}}chatbox_delete{{/lang}}'><i class='fa fa-times'></i></span>{{/canDelete}}     {{#canReport}}<span class='msgManageBtn reportBtn' data-action='reportMSG'  title='{{#lang}}chatbox_report{{/lang}}'><i class='fa fa-exclamation'></i>a</span>{{/canReport}}     {{#canBeBlocked}}<span class='msgManageBtn blockBtn' data-action='addToBlockedList' data-key='{{chatterKey}}' data-ip='{{chatterIP}}' data-name='{{chatterName}}' title='{{#lang}}chatbox_block{{/lang}}'><i class='fa fa-ban'></i></span>{{/canBeBlocked}}    {{/id}}   </span>  </div> </div></li>");ips.templates.set('chatbox.style.talkie'," <li class='{{#id}}chat_row{{/id}} chatbox_style4 {{#callme}}mentionMe{{/callme}}' {{#id}}id='{{id}}'{{/id}}> {{^isMe}}  <div class='ipsPad_half {{#chatterPhoto}}ipsPhotoPanel ipsPhotoPanel_tiny{{/chatterPhoto}} ipsClearfix'>   <a href='#' data-member='{{chatterName}}' data-id='{{chatterID}}' data-url='{{chatterUrl}}' {{#memberHovercard}}data-ipshover data-ipshover-target='{{memberHovercard}}' data-ipsHover-onClick{{/memberHovercard}} class='ipsUserPhoto ipsUserPhoto_tiny' id='ips_uid_{{chatterID}}'>    <img src='{{chatterPhoto}}' alt=''>   </a>   <div class='ipsClearfix'>    <div class='talkie bubbleHim' id='chatRow_{{id}}' data-id='{{id}}'>     <span class='chatbox_msg'>{{{content}}}</span>    </div>   </div>   <div class='msgInfo'>    <span {{#showAgoTime}}data-livestamp='{{showAgoTime}}'{{/showAgoTime}} class='cbTime ipsType_small ipsType_light'>     {{#showDate}}{{showDate}}{{/showDate}}    </span>&nbsp;    {{#id}}     {{#canManageMSG}}<span class='msgOptions ipsType_light' data-action='msgOptions' title='{{#lang}}chatbox_mana_msg{{/lang}}'><i class='fa fa-ellipsis-h'></i></span>{{/canManageMSG}}     {{#canEdit}}<span class='msgManageBtn editBtn' data-action='editMSG'  title='{{#lang}}chatbox_edit{{/lang}}'><i class='fa fa-pencil'></i></span>{{/canEdit}}     {{#canDelete}}<span class='msgManageBtn deleteBtn' data-action='deleteMSG'  title='{{#lang}}chatbox_delete{{/lang}}'><i class='fa fa-times'></i></span>{{/canDelete}}     {{#canReport}}<span class='msgManageBtn reportBtn' data-action='reportMSG'  title='{{#lang}}chatbox_report{{/lang}}'><i class='fa fa-exclamation'></i>a</span>{{/canReport}}     {{#canBeBlocked}}<span class='msgManageBtn blockBtn' data-action='addToBlockedList' data-key='{{chatterKey}}' data-ip='{{chatterIP}}' data-name='{{chatterName}}' title='{{#lang}}chatbox_block{{/lang}}'><i class='fa fa-ban'></i></span>{{/canBeBlocked}}    {{/id}}   </span>  </div> {{/isMe}} {{#isMe}}  <div class='ipsPad_half ipsClearfix'>   <div class='ipsClearfix'>    <div class='talkie bubbleMe' id='chatRow_{{id}}' data-id='{{id}}'>     <span class='chatbox_msg'>{{{content}}}</span>    </div>   </div>   <div class='msgInfo ipsType_right'>    <span {{#showAgoTime}}data-livestamp='{{showAgoTime}}'{{/showAgoTime}} class='cbTime ipsType_small ipsType_light'>     {{#showDate}}{{showDate}}{{/showDate}}    </span>&nbsp;    {{#id}}     {{#canEdit}}<span class='msgManageBtn editBtn' data-action='editMSG'  title='{{#lang}}chatbox_edit{{/lang}}'><i class='fa fa-pencil'></i></span>{{/canEdit}}     {{#canDelete}}<span class='msgManageBtn deleteBtn' data-action='deleteMSG'  title='{{#lang}}chatbox_delete{{/lang}}'><i class='fa fa-times'></i></span>{{/canDelete}}     {{#canReport}}<span class='msgManageBtn reportBtn' data-action='reportMSG'  title='{{#lang}}chatbox_report{{/lang}}'><i class='fa fa-exclamation'></i>a</span>{{/canReport}}     {{#canBeBlocked}}<span class='msgManageBtn blockBtn' data-action='addToBlockedList' data-key='{{chatterKey}}' data-ip='{{chatterIP}}' data-name='{{chatterName}}' title='{{#lang}}chatbox_block{{/lang}}'><i class='fa fa-ban'></i></span>{{/canBeBlocked}}     {{#canManageMSG}}<span class='msgOptions ipsType_light' data-action='msgOptions' title='{{#lang}}chatbox_mana_msg{{/lang}}'><i class='fa fa-ellipsis-h'></i></span>{{/canManageMSG}}    {{/id}}   </div>  </div> {{/isMe}}</li>");ips.templates.set('chatbox.style.system'," <li class='ipsDataItem {{#id}}chat_row{{/id}} system_chat' {{#id}}id='{{id}}'{{/id}}> <div class='ipsPad_half ipsClearfix'>  <span class='chatbox_msg ipsType_light' id='chatRow_{{id}}' {{#id}}id='{{id}}'{{/id}}><i class='fa fa-angle-double-right'></i> {{{content}}}</span>  <span class='ipsPos_right'>   <span {{#showAgoTime}}data-livestamp='{{showAgoTime}}'{{/showAgoTime}} class='cbTime ipsType_small ipsType_light'>    {{#showDate}}{{showDate}}{{/showDate}}   </span>&nbsp;   {{#canDelete}}    <span class='msgOptions ipsType_light' data-action='msgOptions' title='{{#lang}}chatbox_mana_msg{{/lang}}'><i class='fa fa-ellipsis-h'></i></span>    <span class='msgManageBtn deleteBtn' data-action='deleteMSG'  title='{{#lang}}chatbox_delete{{/lang}}'><i class='fa fa-times'></i></span>   {{/canDelete}}  </span> </div></li>");ips.templates.set('chatbox.disconnected'," <div class='disconnected'> <span>  <i class='fa fa-exclamation-triangle'></i><br>  {{msg}}<br>  {{#btn}}   <a href='#' id='btnConnect' class='ipsButton ipsButton_primary ipsButton_verySmall ipsSpacer_top ipsSpacer_half' data-action='connect'>{{btn}}</a>  {{/btn}} </span></div>");ips.templates.set('chatbox.chatters.list'," <ul class='ipsMenu ipsMenu_normal menuChatters' id='chattersList_{{roomID}}_menu' style='display: none'> <li class='ipsMenu_title'>{{#lang}}chatbox_online_users{{/lang}}</li> <div class='ipsMenu_innerContent chatters_content'>  <div class='ipsLoading chatbox_chatters_Panel'>   <ul class='ipsDataList'></ul>  </div> </div></ul>");ips.templates.set('chatbox.chatter.row'," <li class='ipsDataItem chatter_row'> <div class='ipsPad_half ipsPhotoPanel ipsPhotoPanel_tiny ipsClearfix'>  <a href='#' data-member='{{chatterName}}' data-id='{{chatterID}}' data-url='{{chatterUrl}}' {{#memberHovercard}}data-ipshover data-ipshover-target='{{memberHovercard}}' data-ipsHover-onClick{{/memberHovercard}} class='ipsUserPhoto ipsUserPhoto_tiny' id='ips_uid_{{chatterID}}'>   <img src='{{chatterPhoto}}' alt=''>  </a>  <div class='nameInList ipsClearfix'>   <a href='#' class='username' data-action='mention' data-member='{{chatterName}}' data-id='{{chatterID}}' data-url='{{chatterUrl}}' {{#memberHovercard}}data-ipshover data-ipshover-target='{{memberHovercard}}'{{/memberHovercard}}>    {{#is_anon}}<span class='cb_isAnon ipsType_light' data-ipsTooltip title='{{#lang}}chatbox_is_anon{{/lang}}'><i class='fa fa-eye-slash'></i></span>&nbsp;{{/is_anon}}    {{{chatterNameFormat}}}   </a>   <div class='ipsList_inline'>    {{#privateChat}}     <span data-controller='bim.chatbox.startChat'>      <a href='#' class='ipsButton ipsButton_positive ipsButton_verySmall' data-action='startChat' data-memberID='{{chatterID}}'>       <i class='fa fa-comment'></i> {{#lang}}chatbox_send_private{{/lang}}      </a>     </span>&nbsp;    {{/privateChat}}    {{#canBeBlocked}}     <a href='#' class='ipsButton ipsButton_negative ipsButton_verySmall' data-action='addToBlockedList' data-key='{{chatterKey}}' data-ip='{{chatterIP}}' data-name='{{chatterName}}'>      <i class='fa fa-ban'></i> {{#lang}}chatbox_block{{/lang}}     </a>    {{/canBeBlocked}}   </div>  </div> </div></li>");ips.templates.set('chatbox.parseImage'," <a href='{{url}}' class='chatboxImgContainer ipsImage ipsThumb_small' data-ipslightbox> {{#blankImage}}  <img src='{{blankImage}}' data-src='{{url}}' class='chatboxIMG lazyload'> {{/blankImage}} {{^blankImage}}  <img src='{{url}}' class='chatboxIMG'> {{/blankImage}}</a>");ips.templates.set('chatbox.parseURL',"<a href='{{url}}' target='_blank' class='chatboxURL' rel='noopener noreferrer'>{{text}}</a>");ips.templates.set('chatbox.parsedVideo'," <div class='chatboxVideoContainer'> <div class='chatboxVideo ipsSpacer_both ipsSpacer_half'>  {{#blankImage}}   <img src='{{blankImage}}' data-src='{{img}}' class='lazyload'>  {{/blankImage}}  {{^blankImage}}   <img src='{{img}}'>  {{/blankImage}}  <a href='#' data-action='playVideoInIframe' data-videoSource='{{source}}' data-videoID='{{id}}'></a> </div> <a class='chatboxVideoPopupOpen' data-action='playVideoInPopup' data-videoSource='{{source}}' data-videoID='{{id}}'>  <i class='fa fa-window-maximize' aria-hidden='true'></i>&nbsp;&nbsp;{{#lang}}chatbox_expandPlayer{{/lang}} </a></div>");ips.templates.set('chatbox.videoIframe',"  <iframe class='chatboxPlayer' data-videoSource='{{source}}' data-videoID='{{id}}' width='200' height='113' src='{{play}}' frameborder='0' allow='autoplay; encrypted-media' allowfullscreen></iframe>");ips.templates.set('chatbox.videoPopup'," <div class='chatboxVideoWrapper videopopup_{{chatID}}'> <iframe width='560' height='315' src='https://www.youtube.com/embed/{{videoID}}?autoplay=1' frameborder='0' allow='autoplay; encrypted-media' allowfullscreen></iframe></div>");ips.templates.set('chatbox.editInput'," <textarea type='text' class='editChatInput' data-action='doEdit' autocomplete='off'></textarea>");ips.templates.set('chatbox.loadMore'," <li id='loadMore' class='ipsDataItem ipsType_center ipsPad'><span class='ipsLoading ipsLoading_tiny'></span></li>");ips.templates.set('chatbox.convo.list.rooms'," <li class='ipsDataItem rooms ipsPad_half ipsClearfix ipsCursor_pointer' data-action='openRoom' data-roomID='{{id}}'> <a href='#' class='ipsPos_left ipsType_blendLinks' title='{{title}}'>  <i class='fa fa-{{icon}}'></i> {{title}} </a> {{#users}}<span class='ipsPos_right ipsBadge ipsBadge_positive'>{{users}}</span>{{/users}}</li>");ips.templates.set('chatbox.blankRoom'," <div class='room_{{roomID}}'></div>");ips.templates.set('chatbox.blankCon'," <div class='convo_{{conID}}'></div>");ips.templates.set('chatbox.newcon.chats'," <li class='ipsAutocompleteMenu_item ipsClearfix ipsCursor_pointer {{#unread}}mentionMe{{/unread}} convoRow_{{id}}' data-action='openConversation' data-conID='{{id}}'> <div class='ipsPhotoPanel ipsPhotoPanel_tiny'>  <span class='chatbox_one_avatar'>   <i class='fa fa-circle ipsOnlineStatus_online {{^isOnline}}ipsHide{{/isOnline}}'></i>   <span class='ipsUserPhoto ipsUserPhoto_tiny'><img src='{{icon}}'></span>  </span>  <div class='ipsClearfix'>   <span class='ipsPos_left'><b>{{{title}}} <span class='newMsgCountTxt'>{{#unread}}({{unread}}){{/unread}}</span></b></span>   {{#time}}<span class='ipsPos_right ipsType_light ipsType_small'>{{time}}</span>{{/time}}   {{#lastMsg}}<br><div class='cbLastMSG ipsType_light'>{{lastMsg}}</div>{{/lastMsg}}  </div> </div></li>");ips.templates.set('chatbox.newcon.temp'," <li class='tempCon ipsAutocompleteMenu_item ipsClearfix ipsCursor_pointer convoRow_{{id}}' data-action='openConversation' data-conID='{{id}}'></li>");ips.templates.set('chatbox.newcon.mem'," <li class='ipsAutocompleteMenu_item ipsClearfix ipsCursor_pointer' {{^isBan}}data-action='openConversation' data-memberID='{{id}}' data-conID='{{conID}}'{{/isBan}}> <div class='ipsPhotoPanel ipsPhotoPanel_tiny'>  <span class='chatbox_one_avatar'>   <i class='fa fa-circle ipsOnlineStatus_online cbMemOnline {{^isOnline}}ipsHide{{/isOnline}}'></i>   <span class='ipsUserPhoto ipsUserPhoto_tiny'><img src='{{photo}}'></span>  </span>  <div>   <strong>{{{name}}}</strong><br>   <span class='ipsType_light'>{{{extra}}}</span>  </div> </div></li>");ips.templates.set('chatbox.newcon.notify'," <div data-role='newNotification'> <div class='ipsPhotoPanel ipsPhotoPanel_tiny' data-conID='{{{id}}}'>  <span class='ipsUserPhoto ipsUserPhoto_tiny'><img src='{{{icon}}}'></span>  <div class='ipsClearfix'>   <span class='ipsPos_left'><b>{{{title}}}</b></span>   {{#time}}<span class='ipsPos_right ipsType_light ipsType_small'>{{time}}</span>{{/time}}   {{#lastMsg}}<br><span class='cbLastMSG ipsType_small'>{{{lastMsg}}}</span>{{/lastMsg}}  </div> </div></div>");ips.templates.set('chatbox.emoticons'," <div class='ipsMenu ipsMenu_normal cbMenuEmoticons' id='{{id}}_menu' style='display: none' data-editorID='{{editor}}' data-controller='core.global.editor.emoticons'> <div class='ipsMenu_headerBar'>  <p class='ipsType_reset ipsPos_right'>   <a href='#' class='ipsType_blendLinks ipsHide' data-role='skinToneMenu' data-ipsMenu data-ipsMenu-appendTo='#{{id}}_menu' id='{{id}}_tones'>{{#lang}}emoji_skin_tone{{/lang}} <i class='fa fa-caret-down'></i></a>   &nbsp;&nbsp;&nbsp;   <a href='#' class='ipsType_blendLinks ipsHide' data-role='categoryTrigger' data-ipsMenu data-ipsMenu-appendTo='#{{id}}_menu' id='{{id}}_more'>{{#lang}}emoticonCategories{{/lang}} <i class='fa fa-caret-down'></i></a>  </p>  <h4 class='ipsType_sectionHead'>{{#lang}}emoji{{/lang}}</h4>  <ul class='ipsMenu ipsMenu_veryNarrow ipsCursor_pointer' id='{{id}}_tones_menu' role='menu' style='display: none'>   <li class='ipsMenu_title'>{{#lang}}emoji_skin_tone{{/lang}}</li>   <li class='ipsMenu_item' role='menuitem' data-ipsMenuValue='none'><a>{{#lang}}emoji_skin_tone_default{{/lang}}</a></li>   <li class='ipsMenu_sep'><hr></li>   <li class='ipsMenu_item' role='menuitem' data-ipsMenuValue='light'><a>\uD83C\uDFFB {{#lang}}emoji_skin_tone_light{{/lang}}</a></li>   <li class='ipsMenu_item' role='menuitem' data-ipsMenuValue='medium-light'><a>\uD83C\uDFFC {{#lang}}emoji_skin_tone_medium_light{{/lang}}</a></li>   <li class='ipsMenu_item' role='menuitem' data-ipsMenuValue='medium'><a>\uD83C\uDFFD {{#lang}}emoji_skin_tone_medium{{/lang}}</a></li>   <li class='ipsMenu_item' role='menuitem' data-ipsMenuValue='medium-dark'><a>\uD83C\uDFFE {{#lang}}emoji_skin_tone_medium_dark{{/lang}}</a></li>   <li class='ipsMenu_item' role='menuitem' data-ipsMenuValue='dark'><a>\uD83C\uDFFF {{#lang}}emoji_skin_tone_dark{{/lang}}</a></li>  </ul>  <ul data-role='categoryMenu' class='ipsMenu ipsMenu_auto ipsCursor_pointer' id='{{id}}_more_menu' role='menu' style='display: none'>  </ul> </div> <div class='ipsMenu_innerContent ipsEmoticons_content'>  <div class='ipsEmpty ipsType_center ipsEmoticons_contentLoading' data-role='emojiLoading'>   {{#lang}}loading{{/lang}}...  </div> </div></div>");;